const themeColors = ["#ec4899", "#8b5cf6", "#6366f1", "#3b82f6", "#0ea5e9", "#06b6d4", "#14b8a6", "#10b981", "#f59e0b", "#f97316", "#ef4444", "#db2777", "#64748b", "#334155", "#84cc16", "#7c3aed"]; let currentThemeColor = "#ec4899", isLightMode = !1; function toggleLightMode() { isLightMode = !isLightMode, applyLightMode(), applyTheme(currentThemeColor), localStorage.setItem("bosquejos_lightmode", isLightMode) } function applyLightMode() { isLightMode ? document.body.classList.add("light-theme") : document.body.classList.remove("light-theme"); document.querySelectorAll(".theme-icon").forEach(e => { e.innerHTML = isLightMode ? '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>' : '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>' }); document.querySelectorAll(".btn-theme-toggle").forEach(e => { e.title = isLightMode ? "Cambiar a Modo Oscuro" : "Cambiar a Modo Claro" }) } function loadConfig() { const e = localStorage.getItem("bosquejos_lightmode"); isLightMode = null === e || "true" === e, applyLightMode(); const t = localStorage.getItem("bosquejos_config"); if (t) { const e = JSON.parse(t); e.fontFamily && (document.getElementById("fontFamily").value = e.fontFamily), e.maxFontSize && (document.getElementById("maxFontSize").value = e.maxFontSize), void 0 !== e.uppercase && (document.getElementById("uppercase").checked = e.uppercase), e.textShadow && (document.getElementById("textShadow").value = e.textShadow), e.marginSize && (document.getElementById("marginSize").value = e.marginSize), e.marginSizeX && (document.getElementById("marginSizeX").value = e.marginSizeX), e.transitionEffect && (document.getElementById("transitionEffect").value = e.transitionEffect), e.bgDim && (document.getElementById("bgDim").value = e.bgDim), e.bgBlur && (document.getElementById("bgBlur").value = e.bgBlur), void 0 !== e.boldText && (document.getElementById("boldText").checked = e.boldText), void 0 !== e.autoFit && (document.getElementById("autoFit").checked = e.autoFit), e.textColor && (document.getElementById("textColor").value = e.textColor), e.shadowColor && (document.getElementById("shadowColor").value = e.shadowColor), e.maxFontSize && (document.getElementById("maxFontSize").value = e.maxFontSize); const o = document.getElementById("lineHeight"); e.lineHeight && o && (o.value = e.lineHeight), e.themeColor ? applyTheme(e.themeColor) : applyTheme(themeColors[0]), updateConfig() } else applyTheme(themeColors[0]), renderColorPicker(), updateConfig(); restoreBackgroundPreview(); setTimeout(() => { document.body.classList.add("theme-transition") }, 100) } async function restoreBackgroundPreview() { const e = localStorage.getItem("bosquejos_bg"), t = localStorage.getItem("bosquejos_bg_type") || "image", o = localStorage.getItem("bosquejos_bg_source"); if (e) if ("db" === o && window.MediaDB) try { const o = await window.MediaDB.getFile(e); if (o) { updateBgPreview(URL.createObjectURL(o), t) } } catch (e) { console.error("Error restaurando preview DB:", e) } else "db" !== o && (updateBgPreview(null, t), document.getElementById("bgPreviewText").innerText = "Fondo Local Activo") } function updateConfig() { const e = { fontFamily: document.getElementById("fontFamily").value, maxFontSize: document.getElementById("maxFontSize") ? document.getElementById("maxFontSize").value : 300, uppercase: document.getElementById("uppercase").checked, boldText: document.getElementById("boldText").checked, autoFit: document.getElementById("autoFit").checked, textColor: document.getElementById("textColor").value, shadowColor: document.getElementById("shadowColor").value, textShadow: document.getElementById("textShadow").value, marginSize: document.getElementById("marginSize").value, marginSizeX: document.getElementById("marginSizeX") ? document.getElementById("marginSizeX").value : 80, lineHeight: document.getElementById("lineHeight") ? document.getElementById("lineHeight").value : .95, transitionEffect: document.getElementById("transitionEffect").value, bgDim: document.getElementById("bgDim").value, bgBlur: document.getElementById("bgBlur").value, themeColor: currentThemeColor }; localStorage.setItem("bosquejos_config", JSON.stringify(e)); document.querySelectorAll("#announcementsView textarea").forEach(t => { t.style.fontFamily = e.fontFamily, t.style.textTransform = e.uppercase ? "uppercase" : "none" }), bc.postMessage({ type: "config", payload: e }) } function renderColorPicker() { const e = document.getElementById("colorGrid"); e && (e.innerHTML = "", themeColors.forEach(t => { const o = document.createElement("div"); o.style.backgroundColor = t, o.style.height = "30px", o.style.borderRadius = "6px", o.style.cursor = "pointer", o.style.border = currentThemeColor === t ? "2px solid white" : "1px solid rgba(255,255,255,0.2)", o.style.boxShadow = currentThemeColor === t ? "0 0 10px " + t : "none", o.style.transition = "transform 0.2s", o.onmouseover = () => o.style.transform = "scale(1.1)", o.onmouseout = () => o.style.transform = "scale(1)", o.onclick = () => applyTheme(t), e.appendChild(o) })) } function applyTheme(e) { currentThemeColor = e; const t = adjustBrightness(e, -25), o = hexToRgba(e, .4), n = (299 * parseInt(e.substr(1, 2), 16) + 587 * parseInt(e.substr(3, 2), 16) + 114 * parseInt(e.substr(5, 2), 16)) / 1e3, a = n > 180, r = n < 40, l = document.documentElement.style; if (r ? (l.setProperty("--accent", "#27272a"), l.setProperty("--brand-gradient", "linear-gradient(135deg, #000 0%, #333 100%)"), l.setProperty("--brand-glow", "rgba(255, 255, 255, 0.15)"), l.setProperty("--text-accent", "#ffffff")) : (l.setProperty("--accent", e), l.setProperty("--brand-gradient", `linear-gradient(135deg, ${e} 0%, ${t} 100%)`), l.setProperty("--brand-glow", o), l.setProperty("--text-accent", e)), l.setProperty("--btn-text-color", a || r ? "#000000" : "#ffffff"), r && l.setProperty("--btn-text-color", "#fff"), l.setProperty("--btn-text-shadow", a ? "none" : "0 1px 2px rgba(0, 0, 0, 0.3)"), l.setProperty("--active-bg", hexToRgba(e, .15)), l.setProperty("--active-border", e), r) l.setProperty("--bg", "#000000"), document.body.style.background = "#000000"; else { if (isLightMode) { const t = `radial-gradient(circle at 10% 10%, ${hexToRgba(e, .4)} 0%, transparent 60%), linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%)`; l.setProperty("--bg", t), document.body.style.background = t } else { const t = `radial-gradient(circle at 0% 0%, ${hexToRgba(e, .8)} 0%, transparent 70%), radial-gradient(circle at 100% 100%, ${hexToRgba(e, .3)} 0%, transparent 60%), #09090b`; l.setProperty("--bg", t), document.body.style.background = t } document.body.style.backgroundAttachment = "fixed", document.body.style.backgroundSize = "cover" } renderColorPicker(), updateConfig() } function toggleOptionsPanel() { const e = document.getElementById("optionsCard"); e.classList.toggle("expanded"); } async function uploadBackground(e) { if (e.files && e.files[0]) { const t = e.files[0], o = t.path, n = t.type.startsWith("video/"); if (o) try { localStorage.setItem("bosquejos_bg", o), localStorage.setItem("bosquejos_bg_type", n ? "video" : "image"), bc.postMessage({ type: "bg", action: "update", payload: { image: o, mediaType: n ? "video" : "image" } }); updateBgPreview(URL.createObjectURL(t), n ? "video" : "image"), console.log("Fondo cargado desde disco:", o) } catch (e) { console.error("Error guardando fondo local:", e) } else { console.log("ðŸš€ Modo Web Optimizado: Guardando en DB y enviando..."); try { window.MediaDB && (await window.MediaDB.saveFile("current_bg", t), localStorage.setItem("bosquejos_bg", "current_bg"), localStorage.setItem("bosquejos_bg_type", n ? "video" : "image"), localStorage.setItem("bosquejos_bg_source", "db")), bc.postMessage({ type: "bg", action: "update", payload: { image: "current_bg", mediaType: n ? "video" : "image", sourceMode: "db" } }); updateBgPreview(URL.createObjectURL(t), n ? "video" : "image") } catch (e) { console.error("Error envÃ­o binario/db:", e), alert("Error al guardar fondo. AsegÃºrate de tener espacio en disco.") } } } } function clearBackground() { bc.postMessage({ type: "bg", action: "clear" }), localStorage.removeItem("bosquejos_bg"), localStorage.removeItem("bosquejos_bg_type"), document.getElementById("bgInput").value = "", updateBgPreview(null) } function updateBgPreview(e, t = "image") { const o = document.getElementById("bgPreviewThumb"), n = document.getElementById("bgPreviewText"); e ? ("video" === t ? (o.style.backgroundImage = "none", o.style.backgroundColor = "#333", o.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><polygon points="10,9 16,12 10,15"/></svg>', o.style.display = "flex", o.style.alignItems = "center", o.style.justifyContent = "center", o.style.color = "#666") : (o.innerHTML = "", o.style.backgroundImage = `url(${e})`, o.style.backgroundColor = "#222", o.style.display = "block"), n.innerText = "Fondo Activo", n.style.color = "var(--success)") : (o.innerHTML = "", o.style.backgroundImage = "none", o.style.backgroundColor = "#222", o.style.display = "block", n.innerText = "Sin fondo", n.style.color = "#666") }