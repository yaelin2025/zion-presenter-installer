<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWA / App Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Zion Cast">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Zion Cast">

    <title>Zion Cast</title>
    <link rel="icon" href="img/favicon.png" type="image/png">
    <script src="socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="css/zion-panel-style.css?v=NO_ANIMATIONS_V6">
    <!-- Sistema de Bienvenida (Modular) -->
    <link rel="stylesheet" href="css/zion-welcome-modal.css?v=9">
    <script src="js/bibles/bible_rv1960.js"></script>
    <!-- <script src="js/zion-welcome-system.js" defer></script> -->
    <script src="js/zion-analytics.js" defer></script>
    <link rel="stylesheet" href="css/zion-tutorial.css?v=1">
    <style>
        /* --- SPLASH SCREEN PREMIUM --- */
        #zion-init-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #09090b;
            /* Comando Center Background Effect */
            background-image:
                radial-gradient(circle at 15% 50%, rgba(138, 43, 226, 0.15) 0%, transparent 60%),
                radial-gradient(circle at 85% 85%, rgba(0, 255, 255, 0.12) 0%, transparent 60%),
                radial-gradient(circle at 50% 0%, rgba(236, 72, 153, 0.1) 0%, transparent 70%);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, pointer-events 0s 0.5s;
            pointer-events: all;
        }

        #zion-init-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .splash-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .splash-header {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .splash-logo-svg {
            width: 180px;
            height: auto;
            max-height: 180px;
            object-fit: contain;
            filter: drop-shadow(0 0 30px rgba(255, 87, 34, 0.4));
            animation: splashLogoSequence 1.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .splash-text-box {
            text-align: left;
            opacity: 0;
            animation: splashTextSequence 1.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            animation-delay: 0.2s;
        }

        .splash-title-text {
            color: #ffffff;
            font-weight: 900;
            font-size: 80px;
            letter-spacing: 5px;
            line-height: 0.8;
            text-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .splash-subtitle-text {
            color: #FF5252;
            font-weight: 300;
            font-size: 24px;
            letter-spacing: 12px;
            margin-top: 5px;
            text-transform: uppercase;
            opacity: 0.8;
        }

        @keyframes splashLogoSequence {
            0% {
                transform: scale(0.9);
                opacity: 0;
                filter: blur(15px);
            }

            100% {
                transform: scale(1) translateY(-3px);
                opacity: 1;
                filter: blur(0);
            }
        }

        @keyframes splashTextSequence {
            0% {
                transform: translateX(-30px);
                opacity: 0;
                filter: blur(10px);
            }

            100% {
                transform: translateX(0);
                opacity: 1;
                filter: blur(0);
            }
        }

        @keyframes splashCreditSequence {
            0% {
                transform: translateY(20px);
                opacity: 0;
                filter: blur(10px);
            }

            100% {
                transform: translateY(0);
                opacity: 1;
                filter: blur(0);
            }
        }

        /* Developer Credit in Splash */
        .splash-dev-credit {
            margin-top: 25px;
            font-size: 0.65rem;
            font-weight: 400;
            letter-spacing: 5px;
            color: rgba(255, 255, 255, 0.4);
            opacity: 0;
            animation: splashCreditSequence 2.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            animation-delay: 0.8s;
            text-transform: uppercase;
        }

        .splash-dev-credit span {
            display: block;
            margin-top: 8px;
            font-size: 0.85rem;
            font-weight: 800;
            letter-spacing: 6px;
            background: linear-gradient(135deg, #FFD700, #FF5722, #E91E63, #9C27B0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(255, 87, 34, 0.3);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .quick-tag {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--text);
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-tag:hover {
            background: var(--accent);
            color: #000;
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        /* --- FIX: Selectores con fondo oscuro en Windows --- */
        select,
        option {
            background-color: #09090b !important;
            color: #ffffff !important;
        }

        select:focus {
            outline: 2px solid var(--accent);
            outline-offset: -1px;
        }

        @keyframes pulseGlow {
            0% {
                opacity: 0.4;
                transform: scale(0.9);
                box-shadow: 0 0 5px #00ff00;
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
                box-shadow: 0 0 15px #00ff00;
            }

            100% {
                opacity: 0.4;
                transform: scale(0.9);
                box-shadow: 0 0 5px #00ff00;
            }
        }
    </style>
</head>

<body style="position: relative;"> <!-- Ensure relative for header placement -->
    <!-- Global SVG Assets (Shared Gradients) -->
    <svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1"
        xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="zionGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#FF9800" />
                <stop offset="50%" style="stop-color:#F44336" />
                <stop offset="100%" style="stop-color:#9C27B0" />
            </linearGradient>
        </defs>
    </svg>

    <div id="zion-init-overlay">
        <div class="splash-content">
            <div class="splash-header">
                <!-- Official Logo PNG -->
                <img src="img/solologo.png" class="splash-logo-svg" alt="Zion Logo">

                <div class="splash-text-box">
                    <div class="splash-title-text">ZION</div>
                    <div class="splash-subtitle-text">CAST</div>
                </div>
            </div>

            <!-- Developer Credit Centered Bottom -->
            <div class="splash-dev-credit">
                DESARROLLADO POR <span>YAEL GUTIERREZ</span>
            </div>
        </div>
    </div>


    <body style="position: relative;"> <!-- Ensure relative for header placement -->


        <header>
            <div id="headerLogoArea" style="display: flex; align-items: center; gap: 12px; cursor: pointer;"
                onclick="showAboutModal()">
                <img src="img/solologo.png" alt="Logo" style="width: 65px; height: 65px; object-fit: contain;">
                <div style="text-align: left;">
                    <div
                        style="font-weight: 800; font-size: 24px; letter-spacing: 1px; color: white; line-height: 0.9;">
                        ZION</div>
                    <div
                        style="font-weight: 300; font-size: 11px; letter-spacing: 4px; color: var(--text-muted); line-height: 1; margin-top: 2px;">
                        CAST</div>
                </div>
            </div>

            <!-- NAVEGACIÓN Y VISIBILIDAD (Aesthetic Sync) -->
            <div style="flex: 1; display: flex; justify-content: center; gap: 20px;">
                <div class="nav-tabs" style="width: 400px; margin-top: 0;">

                    <button class="nav-tab active" onclick="openViewerPopup()"
                        title="Abrir Visor en ventana emergente">ABRIR VISOR</button>
                    <button id="btnViewer" class="nav-tab" onclick="toggleViewerModal()">VISOR OBS</button>
                    <button id="btnBackground" class="nav-tab" onclick="toggleUnsplashModal()">FONDOS</button>
                </div>

                <div id="visibilityControls" class="nav-tabs"
                    style="width: 500px; margin-top: 0; background: rgba(255,255,255,0.03);">
                    <button id="togAll" class="nav-tab">TODOS</button>
                    <div style="width: 1px; height: 16px; background: rgba(255,255,255,0.1); align-self: center;"></div>
                    <button id="togTitle" class="nav-tab active">TÍTULO</button>
                    <button id="togCenter" class="nav-tab">MENSAJE</button>
                    <button id="togBl" class="nav-tab active">PRED.</button>
                    <button id="togCb" class="nav-tab active">CITA B.</button>
                    <button id="togBr" class="nav-tab active">ÚLT. C.</button>
                </div>
            </div>


            <div style="display: flex; align-items: center; gap: 8px;">
                <div id="statusDot" class="status-dot dot-offline" title="Estado de Conexión"
                    style="margin-right: 10px;"></div>


                <div class="nav-tabs"
                    style="margin-top: 0; padding: 4px; height: 42px; box-sizing: border-box; display: flex; align-items: center; gap: 4px;">
                    <!-- Network Status Indicator -->
                    <div class="nav-tab"
                        style="flex: 0 0 32px; display: flex; align-items: center; justify-content: center; padding: 0; cursor: default;">
                        <div id="netStatus" title="Estado de la Red" style="width: 10px; height: 10px; border-radius: 50%; background: #666; 
                            border: 2px solid rgba(255,255,255,0.2); 
                            box-shadow: inset 0 1px 2px rgba(255,255,255,0.2), 0 0 5px rgba(0,0,0,0.5);
                            transition: all 0.3s;"></div>
                    </div>

                    <!-- Tutorial / Help Button -->
                    <button onclick="ZionTutorial.start()" id="btnHelp" class="nav-tab"
                        style="flex: 0 0 32px; padding: 0; display: flex; align-items: center; justify-content: center;"
                        title="Manual Interactivo">
                        <span style="font-weight: 900; color: #FF9800; font-size: 1.1rem;">?</span>
                    </button>

                    <!-- Settings Button -->
                    <button onclick="toggleConfigDrawer()" id="btnConfig" class="nav-tab"
                        style="flex: 0 0 32px; padding: 0; display: flex; align-items: center; justify-content: center;"
                        title="Ajustes de Diseño">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                    </button>

                    <!-- Contact Button -->
                    <button onclick="toggleContactModal()" id="btnContact" class="nav-tab"
                        style="flex: 0 0 32px; padding: 0; display: flex; align-items: center; justify-content: center;"
                        title="Contacto & Soporte">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z">
                            </path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </button>
                </div>



            </div>
        </header>

        <div class="panel-container">
            <div class="main-grid" style="
            display: grid;
            grid-template-columns: 3fr 3fr 4fr;
            grid-template-rows: auto 1fr;
            gap: 20px;
            padding: 0 20px 20px 20px;
            width: 100%;
            flex: 1; /* Ocupar el espacio restante del flex container padre */
            min-height: 0; /* Importante para que el grid no desborde en Firefox/Flex */
            box-sizing: border-box;
            overflow: hidden;
        ">

                <!-- COLUMNA 1: EDITOR (Arriba) & PERMANENTES (Abajo) -->
                <!-- Fila 1: Editor -->
                <section class="glass-card main-card"
                    style="grid-column: 1; grid-row: 1; display: flex; flex-direction: column; overflow: hidden; padding: 20px; min-height: 0; height: 100%;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                        <h2 style="font-size: 0.8rem; margin:0; border:none; padding:0;">MENSAJE EN VIVO</h2>
                        <div style="display:flex; gap: 5px;">
                            <button id="btnHighlight" title="Resaltar" class="btn-opt"
                                style="padding:3px 8px; font-size:0.7rem; display:flex; align-items:center; gap:4px;">
                                DESTACAR
                            </button>
                            <button id="btnExitVerse" title="Volver a Modo Cast" class="btn-opt"
                                style="padding:3px 8px; font-size:0.7rem; display:flex; align-items:center; gap:4px;">
                                VOLVER A CAST
                            </button>
                        </div>
                    </div>
                    <textarea id="center" placeholder="Escribe aquí el mensaje..."></textarea>

                    <!-- SLOTS -->
                    <div style="margin-top:8px; padding-top:8px; border-top: 1px solid var(--border-color);">
                        <div class="slots-area" style="justify-content: space-between; gap: 4px;">
                            <button class="slot-btn" data-slot="1">1</button>
                            <button class="slot-btn" data-slot="2">2</button>
                            <button class="slot-btn" data-slot="3">3</button>
                            <button class="slot-btn" data-slot="4">4</button>
                            <button class="slot-btn" data-slot="5">5</button>
                            <button class="slot-btn" data-slot="6">6</button>
                            <button class="slot-btn" data-slot="7">7</button>
                            <button class="slot-btn" data-slot="8">8</button>
                            <button class="slot-btn" data-slot="9">9</button>
                            <button class="slot-btn" data-slot="10">10</button>
                        </div>
                    </div>
                </section>

                <!-- Fila 2: Permanentes -->
                <section class="glass-card perm-card"
                    style="grid-column: 1; grid-row: 2; display: flex; flex-direction: column; padding: 20px; min-height: 0; height: 100%;">
                    <h2 style="font-size: 0.8rem; margin-bottom: 12px; margin-top:0; border:none; padding:0;">TEXTOS
                        PERMANENTES</h2>
                    <div style="display:flex; flex-direction:column; gap:12px; flex:1; justify-content: space-evenly;">

                        <!-- PENSAMIENTO (Top) -->
                        <div>
                            <label
                                style="font-size:0.65rem; color:var(--text-secondary); display:block; margin-bottom:2px;">PENSAMIENTO
                                / TÍTULO</label>
                            <input id="title" type="text" placeholder="Ej: La Fe que Mueve Montañas"
                                style="padding: 5px; font-size:0.8rem; width:100%;">
                        </div>

                        <!-- GRID: PREDICADOR & ULTIMA CITA -->
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:6px;">
                            <div>
                                <label
                                    style="font-size:0.65rem; color:var(--text-secondary); display:block; margin-bottom:2px;">PREDICADOR
                                    (Izq)</label>
                                <input id="bl" type="text" placeholder="Ej: Ptr. Juan Perez"
                                    style="padding: 5px; font-size:0.8rem; width:100%;">
                            </div>
                            <div>
                                <label
                                    style="font-size:0.65rem; color:var(--text-secondary); display:block; margin-bottom:2px;">ÚLTIMA
                                    CITA (Der)</label>
                                <input id="br" type="text" placeholder="Ej: Juan 3:16"
                                    style="padding: 5px; font-size:0.8rem; width:100%;">
                            </div>
                        </div>

                        <!-- CITA BASE (Bot) -->
                        <div>
                            <label
                                style="font-size:0.65rem; color:var(--text-secondary); display:block; margin-bottom:2px;">CITA
                                BASE (Abajo)</label>
                            <input id="cb" type="text" placeholder="Ej: Hebreos 11:1"
                                style="padding: 5px; font-size:0.8rem; width:100%;">
                        </div>

                        <!-- NOTAS RÁPIDAS (Local) -->
                        <div style="flex: 1; display: flex; flex-direction: column; margin-top: 5px; min-height: 0;">
                            <label
                                style="font-size:0.65rem; color:var(--accent); display:block; margin-bottom:2px; font-weight: bold; letter-spacing: 0.5px;">NOTAS
                                DEL OPERADOR (SOLO TÚ LO VES)</label>
                            <textarea placeholder="Escribe recordatorios aquí..."
                                style="flex: 1; background: rgba(0,0,0,0.2); border: 1px dashed rgba(255,255,255,0.1); border-radius: 6px; padding: 8px; color: #ddd; font-size: 0.75rem; resize: none; width: 100%; box-sizing: border-box; font-family: 'Inter', sans-serif;"></textarea>
                        </div>
                    </div>
                </section>


                <!-- COLUMNA 2: MONITOR (Fila 1) -->
                <section class="glass-card monitor-card"
                    style="grid-column: 2; grid-row: 1; display: flex; flex-direction: column; padding: 15px; background: var(--card-bg); border-radius: 20px; border: 1px solid var(--card-border); overflow: hidden; height: 100%;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h2
                            style="font-size: 0.7rem; margin: 0; border:none; padding:0; letter-spacing: 1px; color: var(--accent); font-weight: 800; text-transform: uppercase;">
                            MONITOR DE SALIDA (VISOR)</h2>
                        <div id="monitorStatus"
                            style="width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 10px #00ff00; animation: pulseGlow 2s infinite;">
                        </div>
                    </div>
                    <div class="monitor-wrapper"
                        style="width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 10px 40px rgba(0,0,0,0.6); margin: auto 0;">
                        <iframe id="monitorIframe" src="about:blank"
                            style="width: 1280px; height: 720px; border: none; position: absolute; top: 0; left: 0; transform-origin: top left; pointer-events: auto;"></iframe>
                        <div
                            style="position: absolute; inset: 0; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03)); background-size: 100% 4px, 3px 100%; pointer-events: none; opacity: 0.3;">
                        </div>
                        <div
                            style="position: absolute; inset: 0; background: radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.3) 100%); pointer-events: none;">
                        </div>
                    </div>

                    <!-- MONITOR QUICK ACTIONS -->
                    <div class="monitor-quick-actions"
                        style="display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.25); border-radius: 10px; border: 1px solid rgba(255,255,255,0.04);">

                        <!-- REINICIAR POSICIONES -->
                        <button onclick="resetBalloonPositions()" class="btn-quick"
                            title="Restaurar posición y tamaño de globos">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- Flechas circulares de reset -->
                                <path
                                    d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2">
                                </path>
                            </svg>
                            <span>REINICIAR</span>
                        </button>

                        <!-- SOLO TEXTO (Toggle Glass) -->
                        <button id="btnTextOnly" onclick="toggleGlassOnly()" class="btn-quick"
                            title="Quitar globo protector (Solo Texto)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- Globo tachado -->
                                <rect x="3" y="7" width="18" height="10" rx="5" ry="5" opacity="0.5"></rect>
                                <line x1="2" y1="2" x2="22" y2="22"></line>
                            </svg>
                            <span>SOLO TEXTO</span>
                        </button>

                        <!-- BOTÓN OSCURIDAD -->
                        <button id="btnBgDarkness" onclick="toggleBgDarknessSlider()" class="btn-quick"
                            title="Ajustar oscuridad del fondo">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- Sol/Luna (ajuste de brillo) -->
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                            <span>OSCURIDAD</span>
                        </button>

                        <!-- BOTÓN DESENFOQUE -->
                        <button id="btnBgBlur" onclick="toggleBgBlurSlider()" class="btn-quick"
                            title="Ajustar desenfoque del fondo">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- Ondas de desenfoque -->
                                <circle cx="12" cy="12" r="3" opacity="1"></circle>
                                <circle cx="12" cy="12" r="6" opacity="0.6"></circle>
                                <circle cx="12" cy="12" r="9" opacity="0.3"></circle>
                            </svg>
                            <span>DESENFOQUE</span>
                        </button>

                        <!-- MODO CAST -->
                        <button onclick="switchToCast()" class="btn-quick" title="Pasar a Modo Cast (Globos Libres)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- Título largo arriba -->
                                <rect x="4" y="2" width="16" height="3" rx="1.5" ry="1.5" opacity="0.7"></rect>
                                <!-- Globo grande central -->
                                <rect x="6" y="8" width="12" height="7" rx="3" ry="3" opacity="0.9"></rect>
                                <!-- Globo pequeño inferior izquierdo -->
                                <rect x="2" y="18" width="5" height="3" rx="1.5" ry="1.5" opacity="0.6"></rect>
                                <!-- Globo pequeño inferior centro -->
                                <rect x="9.5" y="18" width="5" height="3" rx="1.5" ry="1.5" opacity="0.6"></rect>
                                <!-- Globo pequeño inferior derecho -->
                                <rect x="17" y="18" width="5" height="3" rx="1.5" ry="1.5" opacity="0.6"></rect>
                            </svg>
                            <span>MODO CAST</span>
                        </button>

                        <!-- MODO BIBLIA -->
                        <button onclick="switchToBible()" class="btn-quick"
                            title="Pasar a Modo Biblia (Pantalla Completa)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- Libro abierto -->
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                            </svg>
                            <span>MODO BIBLIA</span>
                        </button>
                    </div>

                    <!-- SLIDER DE OSCURIDAD (COLAPSABLE) -->
                    <div id="bgDarknessSliderContainer"
                        style="max-height: 0; overflow: hidden; transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; opacity: 0; margin-top: 0;">
                        <div
                            style="padding: 6px 10px; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid rgba(255,255,255,0.03); margin-top: 8px;">
                            <div
                                style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 3px;">
                                <label
                                    style="font-size: 0.55rem; color: rgba(255,255,255,0.5); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;">Oscuridad</label>
                                <span id="valBgDarkness"
                                    style="font-size: 0.55rem; color: var(--accent); font-weight: 700;">0.50</span>
                            </div>
                            <input type="range" id="inpBgDarkness" min="0" max="1" step="0.05" value="0.5"
                                style="width: 100%; height: 3px; -webkit-appearance: none; appearance: none; background: rgba(255,255,255,0.08); border-radius: 2px; outline: none; cursor: pointer;">
                        </div>
                    </div>

                    <!-- SLIDER DE DESENFOQUE (COLAPSABLE) -->
                    <div id="bgBlurSliderContainer"
                        style="max-height: 0; overflow: hidden; transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; opacity: 0; margin-top: 0;">
                        <div
                            style="padding: 6px 10px; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid rgba(255,255,255,0.03); margin-top: 8px;">
                            <div
                                style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 3px;">
                                <label
                                    style="font-size: 0.55rem; color: rgba(255,255,255,0.5); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;">Desenfoque</label>
                                <span id="valBgBlur"
                                    style="font-size: 0.55rem; color: var(--accent); font-weight: 700;">0</span>
                            </div>
                            <input type="range" id="inpBgBlur" min="0" max="20" step="1" value="0"
                                style="width: 100%; height: 3px; -webkit-appearance: none; appearance: none; background: rgba(255,255,255,0.08); border-radius: 2px; outline: none; cursor: pointer;">
                        </div>
                    </div>
                </section>

                <!-- COLUMNA 2: NAVEGADOR (Fila 2) -->
                <section class="glass-card bible-nav-card"
                    style="grid-column: 2; grid-row: 2; display: flex; flex-direction: column; padding: 15px; background: var(--card-bg); border-radius: 20px; border: 1px solid var(--card-border); overflow: hidden; height: 100%;">
                    <h2
                        style="font-size: 0.7rem; margin: 0 0 10px 0; border:none; padding:0; letter-spacing: 1px; font-weight: 800; text-transform: uppercase;">
                        NAVEGADOR BÍBLICO</h2>

                    <div style="display: flex; flex-direction: row; gap: 15px; height: 100%; min-height: 0;">
                        <!-- IZQUIERDA: LIBROS -->
                        <div style="flex: 1.2; display: flex; flex-direction: column; min-height: 0;">
                            <label
                                style="font-size: 0.6rem; color: var(--accent); font-weight: 800; text-transform: uppercase; margin-bottom: 4px; letter-spacing: 0.5px;">Libro</label>
                            <div class="scroll-list" style="flex: 1; min-height: 0; overflow-y: auto;">
                                <ul id="bookList" style="list-style:none; padding:0; margin:0;">
                                    <li style="padding:10px; color:var(--text-muted); text-align:center;">Cargando
                                        libros...</li>
                                </ul>
                            </div>
                        </div>

                        <!-- DERECHA: CAPÍTULOS -->
                        <div
                            style="flex: 1.8; display: flex; flex-direction: column; min-height: 0; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 15px;">
                            <label
                                style="font-size: 0.6rem; color: var(--accent); font-weight: 800; text-transform: uppercase; margin-bottom: 4px; letter-spacing: 0.5px;">Capítulo</label>
                            <div id="gridChapters" class="chapters-grid"
                                style="flex: 1; min-height: 0; overflow-y: auto; padding: 2px;">
                                <!-- Llenado por JS -->
                            </div>
                        </div>
                    </div>
                </section>


                <!-- COLUMNA 3: BÚSQUEDA Y RESULTADOS (PRO LOOK) -->
                <section class="glass-card search-card"
                    style="grid-column: 3; grid-row: 1 / span 2; display: flex; flex-direction: column; padding: 10px; overflow: hidden; min-height: 0; height: 100%;">

                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h2 style="font-size: 0.8rem; margin: 0; border:none; padding:0;">BÚSQUEDA BÍBLICA</h2>
                        <button onclick="showRecentVerses()" title="Versículos Recientes" class="nav-tab"
                            style="padding: 3px 8px; border-radius: 4px; width: auto; flex: none; font-size: 0.65rem; position: relative; z-index: 10; cursor: pointer;">
                            RECIENTES
                        </button>
                    </div>

                    <!-- Fused Search Block -->
                    <div style="display: flex; flex-direction: column; margin-bottom: 6px; gap: 0;">
                        <!-- Input Top (No class to avoid CSS interference) -->
                        <div
                            style="position: relative; z-index: 2; display: flex; align-items: center; flex: none; height: 36px;">
                            <input id="bibleInput" type="text" placeholder="Busca Juan 2:2, Jn 2.2 o por frase..."
                                autocomplete="off"
                                style="height: 36px; font-size: 0.9rem; border-radius: 8px 8px 0 0; padding: 0 10px 0 35px; border-bottom: none; width: 100%; display: block; margin: 0; box-sizing: border-box;">
                            <button id="btnClearBible" class="input-clear"
                                style="position: absolute; left: 8px !important; right: auto !important; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; border-radius: 50%; background: rgba(255,255,255,0.15); border: none; padding: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; margin: 0 !important; transition: background 0.2s;">
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white"
                                    stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                    style="opacity: 0.8;">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>

                        <!-- Selector Bottom -->
                        <div
                            style="display: flex; align-items: center; height: 36px; background: var(--input-bg); border: 1px solid var(--input-border); border-top: none; border-radius: 0 0 8px 8px; padding: 0 10px; z-index: 1; flex: none;">
                            <span
                                style="font-size: 0.65rem; color: var(--text-secondary); margin-right: 8px; white-space: nowrap; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">BIBLIA:</span>
                            <select id="bibleVersionSelector"
                                style="flex: 1; height: 100%; border: none !important; background: transparent !important; color: var(--text) !important; font-size: 0.8rem; font-weight: 500; padding: 0; outline: none; box-shadow: none !important; transform: translateY(6px);">
                                <option value="RV1960">Reina Valera 1960</option>
                                <option value="RV1995">Reina Valera 1995</option>
                                <option value="RVA2015">RV Actualizada 2015</option>
                                <option value="RV1909">RV Antigua 1909</option>
                                <option value="RVC2011">RV Contemporánea 2011</option>
                                <option value="RVG">Reina Valera Gomez</option>
                                <option value="RVP2008">RV Purificada 2008</option>
                                <option value="NVI">Nueva Versión Internacional</option>
                                <option value="NTV">Nueva Traducción Viviente</option>
                                <option value="LBLA">La Biblia de las Américas</option>
                                <option value="BTX">La Biblia Textual</option>
                                <option value="DHH">Dios Habla Hoy</option>
                                <option value="PDT">Palabra de Dios para Todos</option>
                                <option value="LXX">Septuaginta (LXX)</option>
                                <option value="OSO">Sagradas Escrituras 1569</option>
                            </select>
                        </div>
                    </div> <!-- Closing Fused Search Block -->

                    <!-- Resultados -->
                    <div id="searchResults" class="scroll-list" style="flex: 1; min-height: 0; padding: 0;"></div>

                    <!-- Elemento oculto necesario para JS -->
                    <div id="versePreview" style="display:none;"></div>
                </section>

            </div>


            <!-- CONFIGURATION DRAWER (Bottom Slide-up) -->
            <div id="configDrawer" style="
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #141416; /* Color solido para maximo rendimiento */
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 200;
            max-height: 48vh;
            overflow-y: auto;
            border-top: 3px solid var(--accent);
        ">
                <!-- DRAWER HEADER (Sticky) -->
                <div style="
                position: sticky;
                top: 0;
                background: rgba(24, 24, 27, 0.95);
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                padding: 6px 15px;
                border-bottom: 1px solid var(--card-border);
                display: flex;
                justify-content: space-between;
                align-items: center;
                z-index: 10;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            ">
                    <h2 style="margin: 0; font-size: 0.8rem; letter-spacing: 1px;">CONFIGURACIÓN DE DISEÑO</h2>
                    <button onclick="toggleConfigDrawer()" class="btn-opt"
                        style="padding: 3px 10px; font-size: 0.7rem;">
                        CERRAR
                    </button>
                </div>

                <!-- DRAWER CONTENT -->
                <div id="drawerContent" style="padding: 10px;">

                    <!-- LAYOUT: Sliders a la izquierda, Temas al centro, Tips a la derecha -->
                    <div style="display: grid; grid-template-columns: 2fr auto 1fr; gap: 15px;">

                        <!-- COLUMNA IZQUIERDA: SLIDERS -->
                        <div style="display:flex; flex-direction:column; gap:6px;">

                            <!-- 1. TARGET SELECTOR -->
                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px;">
                                <label
                                    style="font-size:0.7rem; color:var(--text-secondary); white-space:nowrap;">Elemento:</label>
                                <select id="targetUnit"
                                    style="font-weight:600; flex-grow:1; font-size:0.75rem; padding:4px; background:#09090b; color:white; border:1px solid rgba(255,255,255,0.1); border-radius:4px;">
                                    <option value="center">MENSAJE CENTRAL</option>
                                    <option value="title">PENSAMIENTO</option>
                                    <option value="bl">PREDICADOR</option>
                                    <option value="cb">CITA BASE</option>
                                    <option value="br">ULTIMA CITA</option>
                                </select>
                            </div>

                            <!-- 2. SLIDERS PRINCIPALES (Grid 3 columnas) -->
                            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 8px; row-gap:3px;">
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Tamaño</span> <span
                                            id="valFontSize" class="range-value">Auto</span></div>
                                    <input type="range" id="inpFontSize" min="10" max="200" step="2"
                                        style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Espaciado</span> <span
                                            id="valSpacing" class="range-value">0</span></div>
                                    <input type="range" id="inpSpacing" min="-2" max="10" step="0.5"
                                        style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Zoom</span> <span
                                            id="valScale" class="range-value">1.0</span></div>
                                    <input type="range" id="inpScale" min="0.5" max="2.0" step="0.05"
                                        style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Ancho</span> <span
                                            id="valWidth" class="range-value">1100</span></div>
                                    <input type="range" id="inpWidth" min="100" max="1800" step="10"
                                        style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Alto</span> <span
                                            id="valHeight" class="range-value">400</span></div>
                                    <input type="range" id="inpHeight" min="50" max="900" step="10" style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;">Mayúsculas</div>
                                    <select id="selCase"
                                        style="width:100%; font-size:0.7rem; padding:3px; background:#09090b; color:white; border:1px solid rgba(255,255,255,0.1); border-radius:4px;">
                                        <option value="none">Normal</option>
                                        <option value="uppercase">MAYÚSCULAS</option>
                                        <option value="lowercase">minúsculas</option>
                                        <option value="capitalize">Capitalizar</option>
                                    </select>
                                </div>
                            </div>

                            <!-- 3. ADVANCED (Grid 3 columnas) -->
                            <div
                                style="margin-top:4px; padding-top:6px; border-top:1px solid var(--border-color); display:grid; grid-template-columns: repeat(3, 1fr); gap: 8px; row-gap:3px;">
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Pos X</span> <span
                                            id="valX" class="range-value">0</span></div>
                                    <input type="range" id="inpX" min="-800" max="800" step="5" style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Pos Y</span> <span
                                            id="valY" class="range-value">0</span></div>
                                    <input type="range" id="inpY" min="-500" max="500" step="5" style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Opacidad</span> <span
                                            id="valOp" class="range-value">0.9</span></div>
                                    <input type="range" id="inpOp" min="0.0" max="1.0" step="0.005" style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Radio</span> <span
                                            id="valRadius" class="range-value">30</span></div>
                                    <input type="range" id="inpRadius" min="0" max="100" step="5" style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Pad X</span> <span
                                            id="valPadX" class="range-value">60</span></div>
                                    <input type="range" id="inpPadX" min="0" max="150" step="5" style="height:4px;">
                                </div>
                                <div>
                                    <div class="range-label" style="font-size:0.65rem;"><span>Pad Y</span> <span
                                            id="valPadY" class="range-value">40</span></div>
                                    <input type="range" id="inpPadY" min="0" max="150" step="5" style="height:4px;">
                                </div>
                                <div
                                    style="grid-column: span 3; display:flex; align-items:center; gap:6px; justify-content:center;">
                                    <input type="checkbox" id="chkAutoW" style="margin:0; width:auto;">
                                    <span style="font-size:0.7rem;">Ancho Automático</span>
                                </div>
                            </div>



                            <!-- 4. GLOBO VERSÍCULO CONFIG -->
                            <div
                                style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-color); border-radius: 6px; margin-top:8px; padding:8px;">
                                <div
                                    style="display:flex; align-items:center; gap:6px; margin-bottom:6px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:4px;">
                                    <label style="font-size:0.7rem; color:var(--accent-cyan); font-weight:700;">GLOBO
                                        VERSÍCULO</label>
                                </div>
                                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:6px; row-gap:3px;">
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Ancho</span> <span
                                                id="valVerseW" class="range-value">90</span>%</div>
                                        <input type="range" id="inpVerseW" min="50" max="95" step="1"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Alto</span> <span
                                                id="valVerseH" class="range-value">80</span>%</div>
                                        <input type="range" id="inpVerseH" min="40" max="90" step="1"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Pos X</span> <span
                                                id="valVerseX" class="range-value">5</span>%</div>
                                        <input type="range" id="inpVerseX" min="0" max="25" step="1"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Pos Y</span> <span
                                                id="valVerseY" class="range-value">10</span>%</div>
                                        <input type="range" id="inpVerseY" min="0" max="30" step="1"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Padding</span> <span
                                                id="valVersePad" class="range-value">60</span>px</div>
                                        <input type="range" id="inpVersePad" min="20" max="100" step="5"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Oscuridad</span> <span
                                                id="valVerseOp" class="range-value">0.88</span></div>
                                        <input type="range" id="inpVerseOp" min="0.5" max="0.98" step="0.02"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Tamaño Cita</span>
                                            <span id="valVerseSizeCita" class="range-value">2.6</span>rem
                                        </div>
                                        <input type="range" id="inpVerseSizeCita" min="1" max="5" step="0.1" value="2.6"
                                            style="height:4px;">
                                    </div>
                                    <div>
                                        <div class="range-label" style="font-size:0.65rem;"><span>Sombra Global</span>
                                            <span id="valVerseShadow" class="range-value">0.5</span>
                                        </div>
                                        <input type="range" id="inpVerseShadow" min="0" max="1" step="0.05" value="0.5"
                                            style="height:4px;">
                                    </div>
                                </div>
                            </div>

                            <div style="text-align:right; margin-top:6px;">
                                <!-- Botón de restaurar diseño eliminado por seguridad -->
                            </div>
                        </div>

                        <!-- COLUMNA CENTRAL: SELECTOR DE TEMAS -->
                        <div style="width: 180px;">
                            <div
                                style="background:rgba(255,255,255,0.03); padding:8px; border-radius:6px; height:100%;">
                                <label class="range-label"
                                    style="display:block; margin-bottom:8px; font-size:0.7rem; text-align:center;">TEMA</label>

                                <!-- Dropdown Selector -->
                                <div style="position: relative;">
                                    <select id="themeSelector"
                                        style="width:100%; padding:8px 12px; background:#09090b; border:1px solid var(--border-color); border-radius:6px; color:var(--text); font-size:0.75rem; font-weight:600; cursor:pointer; appearance:none; background-image:url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%278%27 viewBox=%270 0 12 8%27%3e%3cpath fill=%27%2300b0ff%27 d=%27M1.41 0L6 4.58 10.59 0 12 1.41l-6 6-6-6z%27/%3e%3c/svg%3e'); background-repeat:no-repeat; background-position:right 8px center; padding-right:28px;">
                                        <option value="theme-cosmic">Morado Violeta</option>
                                        <option value="theme-emerald" selected>Verde Esmeralda</option>
                                        <option value="theme-sunset">Rojo Atardecer</option>
                                        <option value="theme-midnight">Azul Grisáceo</option>
                                        <option value="theme-azure">Azul Cyan</option>
                                        <option value="theme-flame">Naranja Fuego</option>
                                        <option value="theme-electric">Azul Eléctrico</option>
                                        <option value="theme-neon">Rosa Ale</option>
                                        <option value="custom">Personalizado</option>
                                    </select>
                                </div>

                                <!-- CUSTOM COLOR ENGINE -->
                                <div id="customColorPanel"
                                    style="margin-top:12px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.1); transition:all 0.3s ease;">
                                    <label class="range-label"
                                        style="display:block; margin-bottom:6px; font-size:0.6rem; text-align:center; color:var(--accent);">COLORES
                                        PERSONALIZADOS</label>
                                    <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 5px;">
                                        <div style="display: flex; flex-direction: column; align-items: center;">
                                            <input type="color" id="inpC1"
                                                style="width:100%; height:25px; border:none; background:none; cursor:pointer; padding:0;"
                                                title="Loop (Inicio/Fin)">
                                            <span
                                                style="font-size:8px; color:var(--text-muted); margin-top:2px;">Ext.</span>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center;">
                                            <input type="color" id="inpC2"
                                                style="width:100%; height:25px; border:none; background:none; cursor:pointer; padding:0;"
                                                title="Medio">
                                            <span
                                                style="font-size:8px; color:var(--text-muted); margin-top:2px;">Mid</span>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center;">
                                            <input type="color" id="inpC3"
                                                style="width:100%; height:25px; border:none; background:none; cursor:pointer; padding:0;"
                                                title="Profundidad">
                                            <span
                                                style="font-size:8px; color:var(--text-muted); margin-top:2px;">Prof.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- COLUMNA DE TIPS Y AYUDA -->
                        <div style="flex: 1; min-width: 200px;">
                            <div
                                style="background:rgba(255,255,255,0.03); padding:12px; border-radius:6px; height:100%; border-left: 2px solid var(--accent); position: relative;">
                                <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                    <label class="range-label" style="font-size:0.7rem; margin:0;">TIPS & AYUDA</label>
                                </div>
                                <div
                                    style="font-size: 0.72rem; line-height: 1.5; color: var(--text-muted); display: flex; flex-direction: column; gap: 7px;">
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Los cambios se aplican en <strong>tiempo real</strong> al overlay</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Usa <strong>Ancho</strong> y <strong>Alto</strong> para ajustar el mensaje
                                            central</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>El <strong>Zoom</strong> afecta el tamaño de todos los elementos</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Activa <strong>Ajuste Automático</strong> para adaptar el texto</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Los <strong>temas</strong> cambian el color de toda la interfaz</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Usa <strong>Pad X</strong> y <strong>Pad Y</strong> para el espaciado
                                            interno</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>El <strong>Espaciado</strong> ajusta la separación entre letras</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Cambia entre <strong>Mayúsculas/Minúsculas</strong> sin reescribir</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>El <strong>Globo Versículo</strong> es para mostrar citas bíblicas</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Ajusta la <strong>Oscuridad</strong> para mejorar la legibilidad</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>El <strong>Tamaño</strong> manual desactiva el ajuste automático</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Usa <strong>Pos X</strong> y <strong>Pos Y</strong> para mover
                                            elementos</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>El <strong>Ancho Automático</strong> adapta el globo al contenido</span>
                                    </div>
                                    <div style="display: flex; gap: 6px;">
                                        <span style="color: var(--accent); font-weight: bold;">•</span>
                                        <span>Todos los ajustes se guardan automáticamente</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABOUT MODAL -->
            <!-- Viewer Link Modal -->
            <div id="viewerModal" class="about-backdrop" onclick="toggleViewerModal()">
                <div class="glass-card viewer-card" onclick="event.stopPropagation()"
                    style="max-width: 500px; width: 92%; background: rgba(15, 15, 20, 0.98); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; padding: clamp(20px, 5vw, 40px); display: flex; flex-direction: column; position: relative; box-shadow: 0 40px 100px rgba(0,0,0,0.6); overflow-y: auto; max-height: 92vh;">

                    <!-- Decorative Gradient Top -->
                    <div
                        style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--brand-gradient);">
                    </div>

                    <!-- Header -->
                    <div class="viewer-header"
                        style="text-align: center; margin-bottom: clamp(15px, 4vh, 30px); width: 100%;">
                        <h2
                            style="margin: 0; font-size: clamp(1.3rem, 5vw, 1.8rem); font-weight: 800; color: #fff; letter-spacing: -0.5px; border-bottom: none; padding-bottom: 0;">
                            Enlace del Visor</h2>
                        <p
                            style="color: var(--text-secondary); font-size: clamp(0.75rem, 2.5vw, 0.95rem); margin-top: 8px; opacity: 0.7;">
                            Pega este enlace en una fuente de navegador en OBS</p>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 20px; width: 100%; text-align: left;">
                        <!-- Link Box -->
                        <div class="viewer-link-box"
                            style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: clamp(12px, 3vw, 20px); position: relative; box-sizing: border-box;">
                            <input type="text" id="viewerLinkInput" readonly
                                style="width: 100%; background: transparent; border: none; color: var(--accent); font-size: clamp(0.85rem, 3vw, 1.1rem); font-family: 'JetBrains Mono', monospace; text-align: left; outline: none; cursor: pointer; padding-right: 45px; margin: 0; box-sizing: border-box;"
                                onclick="this.select(); document.execCommand('copy'); showCopyFeedback();">
                            <div
                                style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--accent); opacity: 0.5;">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2">
                                    </path>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                </svg>
                            </div>
                            <div id="copyFeedback"
                                style="position: absolute; inset: 0; background: var(--accent); color: #000; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.9rem; opacity: 0; pointer-events: none; transition: all 0.2s; border-radius: 16px; letter-spacing: 1px;">
                                ✓ COPIADO</div>
                        </div>



                        <!-- OBS Config -->
                        <div class="viewer-obs-config"
                            style="width: 100%; background: rgba(255,255,255,0.03); border-radius: 12px; padding: 15px; border: 1px solid rgba(255,255,255,0.05); box-sizing: border-box; flex: 1;">
                            <h3
                                style="font-size: 0.65rem; font-weight: 700; color: #fff; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1.5px;">
                                Configuración OBS</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div style="display: flex; flex-direction: column; gap: 4px;">
                                    <span
                                        style="font-size: 0.6rem; color: var(--text-secondary); text-transform: uppercase; opacity: 0.6;">Resolución</span>
                                    <span style="font-size: 1rem; font-weight: 800; color: var(--accent);">1280 ×
                                        720</span>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 4px;">
                                    <span
                                        style="font-size: 0.6rem; color: var(--text-secondary); text-transform: uppercase; opacity: 0.6;">Frecuencia</span>
                                    <span style="font-size: 1rem; font-weight: 800; color: var(--accent);">60
                                        FPS</span>
                                </div>
                            </div>
                            <div
                                style="font-size: 0.7rem; color: var(--text-secondary); line-height: 1.4; opacity: 0.8;">
                                <p style="margin: 0;">• Rendimiento optimizado.</p>
                                <p style="margin: 4px 0 0 0;">• "Actualizar cuando sea visible".</p>
                            </div>
                        </div>
                    </div>



                    <!-- Close Button -->
                    <button onclick="toggleViewerModal()"
                        style="width: 100%; padding: clamp(12px, 2.5vh, 16px); background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; font-weight: 700; cursor: pointer; transition: all 0.2s; font-size: clamp(0.85rem, 2.5vw, 1rem); margin-top: clamp(15px, 5vh, 30px);">
                        Cerrar Ventana
                    </button>
                </div>
            </div>

            <!-- BACKGROUND SELECTION MODAL -->
            <div id="unsplashModal" onclick="if(event.target === this) toggleUnsplashModal()"
                style="display:none; position:fixed; inset:0; background: var(--modal-overlay); backdrop-filter:blur(20px); z-index:20000; align-items:center; justify-content:center; opacity:0; transition:opacity 0.3s;">

                <div class="glass-card backgrounds-card" onclick="event.stopPropagation()"
                    style="background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 24px; padding: 25px; width: 95%; max-width: 1100px; height: 85vh; display: flex; flex-direction: column; box-shadow: 0 40px 100px rgba(0,0,0,0.6); position: relative; overflow: hidden;">

                    <!-- Decorative Top -->
                    <div
                        style="position: absolute; top: 0; left: 0; right: 0; height: 6px; background: var(--brand-gradient);">
                    </div>

                    <!-- Modal Header -->
                    <div class="backgrounds-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <h2
                                style="margin: 0; font-size: 1.5rem; color: #fff; font-weight: 800; border: none; padding: 0;">
                                Fondo del Overlay</h2>

                            <!-- Tab Switcher -->
                            <div
                                style="display: flex; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 4px; border: 1px solid rgba(255,255,255,0.08); gap: 4px;">
                                <button id="tabUnsplash" onclick="switchBgTab('unsplash')"
                                    style="display: flex; align-items: center; gap: 8px; padding: 8px 18px; border-radius: 9px; border: none; font-size: 0.85rem; font-weight: 700; cursor: pointer; transition: all 0.3s; background: var(--accent); color: #000;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="2" y1="12" x2="22" y2="12"></line>
                                        <path
                                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                        </path>
                                    </svg>
                                    Unsplash
                                </button>
                                <button id="tabLocal" onclick="switchBgTab('local')"
                                    style="display: flex; align-items: center; gap: 8px; padding: 8px 18px; border-radius: 9px; border: none; font-size: 0.85rem; font-weight: 700; cursor: pointer; transition: all 0.3s; background: transparent; color: rgba(255,255,255,0.7);">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                        <line x1="8" y1="21" x2="16" y2="21"></line>
                                        <line x1="12" y1="17" x2="12" y2="21"></line>
                                    </svg>
                                    Mi Equipo
                                </button>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button onclick="removeBackground()"
                                style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 700; transition: all 0.2s;">
                                Quitar Fondo
                            </button>
                            <button onclick="toggleUnsplashModal()"
                                style="background: rgba(255,255,255,0.05); color: #fff; width: 36px; height: 36px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px;">
                                ✕
                            </button>
                        </div>
                    </div>

                    <!-- UNSPLASH CONTENT AREA -->
                    <div id="unsplashContent" style="display: flex; flex-direction: column; flex: 1; min-height: 0;">
                        <!-- Search Bar -->
                        <div class="bg-search-bar" style="margin-bottom: 20px;">
                            <div style="display: flex; gap: 10px;">
                                <div style="flex: 1; position: relative;">
                                    <input type="text" id="unsplashSearch"
                                        placeholder="Busca en millones de fotos profesionales..."
                                        style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--card-border); color: #fff; padding: 12px 15px 12px 40px; border-radius: 12px; font-size: 0.95rem; outline: none; box-sizing: border-box;"
                                        onkeypress="if(event.key==='Enter') searchUnsplash()">
                                    <span
                                        style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); opacity: 0.6; color: var(--accent);">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="3" stroke-linecap="round"
                                            stroke-linejoin="round">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                        </svg>
                                    </span>
                                </div>
                                <button onclick="searchUnsplash()"
                                    style="background: var(--accent); color: #000; border: none; padding: 0 35px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                                    Buscar
                                </button>
                            </div>

                            <!-- Quick Search Tags -->
                            <div class="bg-quick-tags"
                                style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px;">
                                <button onclick="quickSearch('church worship')" class="quick-tag">Adoración</button>
                                <button onclick="quickSearch('cinematic landscape')" class="quick-tag">Paisajes</button>
                                <button onclick="quickSearch('abstract texture')" class="quick-tag">Abstracto</button>
                                <button onclick="quickSearch('morning sky')" class="quick-tag">Cielo</button>
                                <button onclick="quickSearch('golden hour nature')"
                                    class="quick-tag">Naturaleza</button>
                                <button onclick="quickSearch('minimalist worship background')"
                                    class="quick-tag">Minimalista</button>
                            </div>
                        </div>

                        <!-- Results Grid -->
                        <div id="unsplashResults" class="bg-results-grid"
                            style="flex: 1; min-height: 0; overflow: hidden; display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(2, 1fr); gap: 12px; padding-bottom: 5px;">
                            <div
                                style="grid-column: 1 / -1; text-align: center; color: var(--text-muted); padding: 80px 20px; display: flex; flex-direction: column; align-items: center; gap: 20px;">
                                <div
                                    style="width: 80px; height: 80px; background: rgba(255,255,255,0.03); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--accent); opacity: 0.5;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                </div>
                                <p
                                    style="margin:0; font-size: 1.15rem; color: rgba(255,255,255,0.4); font-weight: 500;">
                                    Busca imágenes de alta resolución para tu fondo</p>
                            </div>
                        </div>

                        <!-- Pagination -->
                        <div id="unsplashPagination"
                            style="display: none; padding: 15px 0; border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: center; align-items: center; gap: 20px;">
                            <button id="btnPrevPage" onclick="changePage(-1)" class="btn-opt"
                                style="padding: 10px 25px;">Anterior</button>
                            <span id="pageInfo"
                                style="color: #fff; font-size: 0.9rem; font-weight: 800; opacity: 0.8;">Página 1</span>
                            <button id="btnNextPage" onclick="changePage(1)" class="btn-opt"
                                style="padding: 10px 25px;">Siguiente</button>
                        </div>
                    </div>

                    <!-- LOCAL UPLOAD CONTENT AREA -->
                    <div id="localContent"
                        style="display: none; flex-direction: column; flex: 1; align-items: center; justify-content: center; padding: 40px; text-align: center;">
                        <input type="file" id="localBgInput" accept="image/*" style="display: none;"
                            onchange="handleLocalBgUpload(this)">

                        <div id="dropZone"
                            style="width: 100%; max-width: 600px; aspect-ratio: 16/9; border: 3px dashed rgba(255,255,255,0.1); border-radius: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; background: rgba(0,0,0,0.2);"
                            onclick="document.getElementById('localBgInput').click()"
                            onmouseover="this.style.borderColor='var(--accent)'; this.style.background='rgba(0,0,0,0.3)'"
                            onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.background='rgba(0,0,0,0.2)'">

                            <div id="uploadPlaceholder">
                                <div
                                    style="width: 90px; height: 90px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 25px; color: var(--accent);">
                                    <svg width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                </div>
                                <h3 style="margin: 0; font-size: 1.6rem; color: #fff; font-weight: 700;">Haz clic o
                                    arrastra para subir</h3>
                                <p style="color: var(--text-muted); margin-top: 12px; font-size: 0.95rem;">JPG, PNG o
                                    WEBP de alta calidad <span style="color: var(--accent); opacity: 0.8;">(Máx
                                        50MB)</span></p>
                            </div>

                            <div id="uploadPreview"
                                style="display: none; width: 100%; height: 100%; position: relative;">
                                <img id="bgPreviewImg"
                                    style="width: 100%; height: 100%; object-fit: cover; border-radius: 20px;">
                                <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; border-radius: 20px;"
                                    onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
                                    <span
                                        style="background: var(--accent); color: #000; padding: 10px 20px; border-radius: 10px; font-weight: 800;">Cambiar
                                        Imagen</span>
                                </div>
                            </div>
                        </div>

                        <div id="applyLocalBtn" style="display: none; margin-top: 30px;">
                            <button onclick="applyLocalBackground()"
                                style="background: var(--brand-gradient); color: #fff; border: none; padding: 15px 60px; border-radius: 15px; font-weight: 800; font-size: 1.1rem; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                                Aplicar como Fondo
                            </button>
                        </div>
                    </div>

                    <!-- Loading Indicator -->
                    <div id="unsplashLoading"
                        style="display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); align-items: center; justify-content: center; border-radius: 20px; z-index: 100;">
                        <div style="text-align: center;">
                            <div
                                style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;">
                            </div>
                            <p id="loadingText" style="color: #fff; font-weight: 700; font-size: 1.1rem;">Buscando
                                inspiración...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL DE CONTACTO (Importado de Zion Presenter) -->
            <div id="contactModal" onclick="closeModal('contactModal')"
                style="display:none; position:fixed; inset:0; background: var(--modal-overlay); backdrop-filter:blur(20px); z-index:20000; align-items:center; justify-content:center; opacity:0; transition:opacity 0.5s;">

                <div class="glass-card about-card" onclick="event.stopPropagation()"
                    style="background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 20px; padding: clamp(20px, 3vh, 30px); width: 92%; max-width: 600px; height: auto; max-height: 90vh; display: flex; flex-direction: column; align-items: stretch; box-shadow: 0 40px 100px rgba(0,0,0,0.5); position: relative; transform-origin: center; overflow: hidden;">

                    <!-- Subtle Background Glow -->
                    <div
                        style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, var(--brand-glow) 0%, transparent 70%); pointer-events: none; opacity: 0.3;">
                    </div>

                    <!-- BOTÓN CERRAR (X) -->
                    <button onclick="closeModal('contactModal')"
                        style="position: absolute; top: 15px; left: 15px; background: var(--card-bg); border: 2px solid var(--card-border); color: var(--text); width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; z-index: 10; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.15);"
                        onmouseover="this.style.background='var(--danger)'; this.style.color='#fff'; this.style.transform='rotate(90deg)'; this.style.borderColor='var(--danger)'"
                        onmouseout="this.style.background='var(--card-bg)'; this.style.color='var(--text)'; this.style.transform='rotate(0deg)'; this.style.borderColor='var(--card-border)'"
                        title="Cerrar (Esc)">
                        ✕
                    </button>

                    <!-- HEADER -->
                    <div style="text-align: center; margin-bottom: 25px; padding-top: 10px;">
                        <h2
                            style="margin: 0 0 10px 0; font-size: clamp(22px, 4vh, 28px); color: var(--text); text-align: center; display: block; width: 100%;">
                            Contacto & Soporte
                        </h2>
                        <p style="margin: 0; font-size: 13px; color: var(--text-muted); line-height: 1.4;">
                            ¿Necesitas ayuda o quieres reportar un problema? Contáctame por cualquiera de estos medios
                        </p>
                    </div>

                    <!-- GRID DE CONTACTOS -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin-bottom: 20px;">

                        <!-- WhatsApp -->
                        <a href="https://wa.me/5216144688228" target="_blank" rel="noopener noreferrer"
                            style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s; position: relative; overflow: hidden;"
                            onmouseover="this.style.borderColor='#25D366'; this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(37, 211, 102, 0.2)'"
                            onmouseout="this.style.borderColor='var(--card-border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="#25D366" style="flex-shrink: 0;">
                                <path
                                    d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
                            </svg>
                            <div style="flex: 1;">
                                <div
                                    style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">
                                    WhatsApp</div>
                                <div style="font-size: 14px; font-weight: 600; color: var(--text);">+52 614 468 8228
                                </div>
                                <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">Chihuahua,
                                    México</div>
                            </div>
                        </a>

                        <!-- Email -->
                        <a href="mailto:YaelGtz@outlook.com"
                            style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s;"
                            onmouseover="this.style.borderColor='var(--accent)'; this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(236, 72, 153, 0.2)'"
                            onmouseout="this.style.borderColor='var(--card-border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--accent)"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z">
                                </path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                            <div style="flex: 1;">
                                <div
                                    style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">
                                    Email</div>
                                <div
                                    style="font-size: 14px; font-weight: 600; color: var(--text); word-break: break-all;">
                                    YaelGtz@outlook.com</div>
                            </div>
                        </a>

                        <!-- Facebook -->
                        <a href="https://www.facebook.com/profile.php?id=61577180301436" target="_blank"
                            rel="noopener noreferrer"
                            style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s;"
                            onmouseover="this.style.borderColor='#1877F2'; this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(24, 119, 242, 0.2)'"
                            onmouseout="this.style.borderColor='var(--card-border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="#1877F2" style="flex-shrink: 0;">
                                <path
                                    d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                            </svg>
                            <div style="flex: 1;">
                                <div
                                    style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">
                                    Facebook</div>
                                <div style="font-size: 14px; font-weight: 600; color: var(--text);">Yael Gutierrez</div>
                            </div>
                        </a>

                        <!-- YouTube -->
                        <a href="https://www.youtube.com/@jannydfds1" target="_blank" rel="noopener noreferrer"
                            style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; text-decoration: none; color: var(--text); transition: all 0.3s;"
                            onmouseover="this.style.borderColor='#FF0000'; this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(255, 0, 0, 0.2)'"
                            onmouseout="this.style.borderColor='var(--card-border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="#FF0000" style="flex-shrink: 0;">
                                <path
                                    d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                            </svg>
                            <div style="flex: 1;">
                                <div
                                    style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 3px;">
                                    YouTube</div>
                                <div style="font-size: 14px; font-weight: 600; color: var(--text);">@jannydfds1</div>
                            </div>
                        </a>

                    </div>

                    <!-- NOTA FINAL -->
                    <div
                        style="margin-top: 10px; padding: 15px; background: linear-gradient(135deg, var(--accent) 0%, var(--brand-glow) 100%); border-radius: 12px; color: white; text-align: center;">
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 5px;">¿Necesitas soporte para tu
                            iglesia?
                        </div>
                        <div style="font-size: 11px; opacity: 0.95; line-height: 1.4;">Asesoría, instalación y
                            capacitación para
                            departamentos de multimedia</div>
                    </div>

                </div>
            </div>

            <!-- MODAL DE CRÉDITOS (ZION CAST) -->
            <div id="aboutOverlay" onclick="this.style.opacity=0; setTimeout(()=>this.style.display='none', 500)"
                style="display:none; position:fixed; inset:0; background: var(--modal-overlay); backdrop-filter:blur(20px); z-index:20000; align-items:center; justify-content:center; opacity:0; transition:opacity 0.5s;">

                <div class="glass-card about-card" onclick="event.stopPropagation()"
                    style="background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 20px; padding: clamp(15px, 2.5vh, 25px); width: 92%; max-width: 650px; height: auto; max-height: 98vh; display: flex; flex-direction: column; align-items: stretch; box-shadow: 0 40px 100px rgba(0,0,0,0.5); position: relative; transform-origin: center; overflow: hidden;">

                    <!-- Subtle Background Glow -->
                    <div
                        style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, var(--brand-glow) 0%, transparent 70%); pointer-events: none; opacity: 0.3;">
                    </div>

                    <!-- BOTÓN CERRAR (X) - SUPERIOR IZQUIERDA -->
                    <button
                        onclick="document.getElementById('aboutOverlay').style.opacity='0'; setTimeout(() => document.getElementById('aboutOverlay').style.display='none', 500)"
                        style="position: absolute; top: 15px; left: 15px; background: var(--card-bg); border: 2px solid var(--card-border); color: var(--text); width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; z-index: 10; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.15);"
                        onmouseover="this.style.background='var(--danger)'; this.style.color='#fff'; this.style.transform='rotate(90deg)'; this.style.borderColor='var(--danger)'"
                        onmouseout="this.style.background='var(--card-bg)'; this.style.color='var(--text)'; this.style.transform='rotate(0deg)'; this.style.borderColor='var(--card-border)'"
                        title="Cerrar (Esc)">
                        ✕
                    </button>

                    <!-- HEADER COMPACTO (CENTRADO) -->
                    <div
                        style="display: flex; justify-content: center; align-items: center; margin-bottom: 1.5vh; border-bottom: 1px solid var(--card-border); padding-bottom: 1vh; position: relative;">

                        <!-- LOGO CENTRADO -->
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <!-- Official Logo PNG -->
                            <img src="img/solologo.png" alt="Logo"
                                style="width:clamp(45px, 7vh, 75px); height:auto; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3)); transform: translateY(-2px);">
                            <div style="text-align: left;">
                                <div
                                    style="font-weight: 900; font-size: clamp(18px, 2.5vh, 24px); letter-spacing: 1px; color: var(--text); line-height: 0.9;">
                                    ZION</div>
                                <div
                                    style="font-weight: 300; font-size: clamp(9px, 1.3vh, 12px); letter-spacing: 3px; color: var(--accent); line-height: 1; margin-top: 2px;">
                                    CAST</div>
                            </div>
                        </div>

                        <!-- INFO DERECHA (ABSOLUTE) -->
                        <div style="position: absolute; right: 0; top: 0; text-align: right;">
                            <div
                                style="font-size: 18px; font-weight: 800; color: var(--text); letter-spacing: 1px; line-height: 1.1;">
                                YAEL GTZ</div>
                            <div
                                style="font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; font-weight: 600;">
                                System Architect & Designer</div>
                        </div>
                    </div>

                    <!-- GRID INFO (4 columnas) -->
                    <div id="techGrid" class="about-grid"
                        style="margin-bottom: 1.5vh; border-bottom: 1px solid var(--card-border); padding: 0 5px 1.5vh 5px; transition: opacity 0.3s ease; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">

                        <!-- COL 1: CORE -->
                        <div>
                            <h3
                                style="color: var(--text); font-size: clamp(9px, 1.2vh, 11px); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; border-bottom: 1px solid var(--card-border); padding-bottom: 3px;">
                                <span style="color: var(--accent);">●</span> Core & Network
                            </h3>
                            <ul
                                style="list-style: none; padding: 0; margin: 0; color: var(--text-muted); font-size: clamp(9px, 1.1vh, 10.5px); line-height: 1.4; font-family: 'Inter', sans-serif;">
                                <li style="display:flex; justify-content:space-between;"><span>Platform</span> <span
                                        style="color: var(--text); font-weight: 600;">Web App</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Backend</span> <span
                                        style="color: var(--text); font-weight: 600;">Node.js + Express</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Network</span> <span
                                        style="color: var(--text); font-weight: 600;">Socket.IO Rooms</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Deploy</span> <span
                                        style="color: var(--text); font-weight: 600;">GitHub Pages</span></li>
                            </ul>
                        </div>

                        <!-- COL 2: MODULES -->
                        <div>
                            <h3
                                style="color: var(--text); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; border-bottom: 1px solid var(--card-border); padding-bottom: 4px;">
                                <span style="color: var(--accent);">●</span> Modules
                            </h3>
                            <ul
                                style="list-style: none; padding: 0; margin: 0; color: var(--text-muted); font-size: 11px; line-height: 1.6; font-family: 'Inter', sans-serif;">
                                <li style="display:flex; justify-content:space-between;"><span>Manager</span> <span
                                        style="color: var(--text); font-weight: 600;">Messages</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Bible</span> <span
                                        style="color: var(--text); font-weight: 600;">RV1960</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Tools</span> <span
                                        style="color: var(--text); font-weight: 600;">Timers</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Info</span> <span
                                        style="color: var(--text); font-weight: 600;">Announcements</span></li>
                            </ul>
                        </div>

                        <!-- COL 3: VISUAL ENGINE -->
                        <div>
                            <h3
                                style="color: var(--text); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; border-bottom: 1px solid var(--card-border); padding-bottom: 4px;">
                                <span style="color: #06b6d4;">●</span> Visual Engine
                            </h3>
                            <ul
                                style="list-style: none; padding: 0; margin: 0; color: var(--text-muted); font-size: 11px; line-height: 1.6; font-family: 'Inter', sans-serif;">
                                <li>• Real-Time Projection</li>
                                <li>• Glassmorphism Design</li>
                                <li>• Dynamic Overlays</li>
                                <li>• Smart Text Sizing</li>
                            </ul>
                        </div>

                        <!-- COL 4: TECH STACK -->
                        <div>
                            <h3
                                style="color: var(--text); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; border-bottom: 1px solid var(--card-border); padding-bottom: 4px;">
                                <span style="color: #10b981;">●</span> Tech Stack
                            </h3>
                            <ul
                                style="list-style: none; padding: 0; margin: 0; color: var(--text-muted); font-size: 11px; line-height: 1.6; font-family: 'Inter', sans-serif;">
                                <li style="display:flex; justify-content:space-between;"><span>Framework</span> <span
                                        style="color: var(--text); font-weight: 600;">Vanilla JS</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Styles</span> <span
                                        style="color: var(--text); font-weight: 600;">CSS3 + Vars</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Database</span> <span
                                        style="color: var(--text); font-weight: 600;">LocalStorage</span></li>
                                <li style="display:flex; justify-content:space-between;"><span>Themes</span> <span
                                        style="color: var(--text); font-weight: 600;">10 Cinematic</span></li>
                            </ul>
                        </div>
                    </div>

                    <!-- MENSAJE PERSONAL (DEDICATORIA) -->
                    <div id="dedication"
                        style="margin: 1.5vh 0; padding: 1.5vh clamp(15px, 5%, 40px); background: var(--quote-bg); border-left: 3px solid var(--accent); border-radius: 8px; transition: opacity 0.3s ease;">
                        <p
                            style="font-family: 'Inter', sans-serif; font-size: clamp(10px, 1.5vh, 13px); line-height: 1.5; color: var(--text); font-style: italic; margin: 0;">
                            "Dicen que el arte nace de la necesidad, Zion Cast nació de la necesidad de nuestra
                            comunidad por
                            facilitar las proyecciones en las iglesias. Este proyecto fue creado con mucho trabajo y una
                            dedicación inquebrantable. Les entrego no solo una herramienta, sino un recurso pensado para
                            que
                            el mensaje brille con excelencia."
                        </p>
                        <div
                            style="text-align: right; margin-top: 8px; font-size: clamp(9px, 1.1vh, 11px); color: var(--accent); font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">
                            — Yael Gutierrez, 2025
                        </div>
                    </div>

                    <!-- SECCIÓN DE CRÉDITOS Y LICENCIAS -->
                    <div id="creditsSection"
                        style="margin: 1.5vh 0; padding: clamp(10px, 1.5vh, 15px); background: var(--quote-bg); border-radius: 8px; transition: opacity 0.3s ease;">
                        <h3 style="color: var(--text); font-size: clamp(10px, 1.3vh, 11px); text-transform: uppercase; letter-spacing: 1.5px; margin: 0 0 10px 0;
border-bottom: 1px solid var(--card-border); padding-bottom: 4px;">
                            Créditos y Reconocimientos
                        </h3>
                        <div style="display: grid; grid-template-columns: 1.3fr 1fr 1fr 1fr; gap: 12px; font-size: clamp(8.5px, 1.1vh, 10px); color: var(--text-muted);
line-height: 1.4;">
                            <div>
                                <strong style="color: var(--text); display: block; margin-bottom: 4px;">Versiones
                                    Bíblicas
                                    (Atribución)</strong>
                                Se incluye el texto de Reina Valera 1960. Todos los derechos pertenecen a sus
                                respectivas
                                Sociedades Bíblicas.
                                Su uso es estrictamente ministerial y sin fines de lucro.
                            </div>
                            <div>
                                <strong style="color: var(--text); display: block; margin-bottom: 4px;">Mensajes y
                                    Contenido</strong>
                                El contenido proyectado pertenece a sus respectivos autores y ministerios.
                                Su uso en esta herramienta es exclusivamente para fines eclesiásticos.
                            </div>
                            <div>
                                <strong style="color: var(--text); display: block; margin-bottom: 4px;">Recursos
                                    Visuales</strong>
                                Tipografías por <span style="color: var(--accent);">Google Fonts</span> (Inter,
                                BenchNine,
                                Roboto). Diseño glassmorphism original.
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div>
                                    <strong style="color: var(--text); display: block; margin-bottom: 4px;">Software &
                                        Legal</strong>
                                    Motor desarrollado con Node.js y Socket.io bajo <span
                                        style="color: var(--accent);">Licencia
                                        Propietaria</span>.
                                </div>
                                <div>
                                    <strong style="color: var(--text); display: block; margin-bottom: 4px;">Aviso
                                        Legal</strong>
                                    Esta herramienta no almacena contenido protegido permanentemente.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FOOTER LEGAL -->
                    <div id="legalFooter"
                        style="border-top: 1px solid var(--card-border); padding-top: 8px; margin-top: auto; display: flex; justify-content: space-between; align-items: center; color: var(--text-muted); font-size: 9px; font-weight: 500; transition: opacity 0.3s ease;">
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <div>
                                &copy; 2026 YAEL GTZ SYSTEMS.<br>
                                <span style="color: var(--accent);">Edición Gratuita</span>
                            </div>
                            <span
                                style="background: var(--active-bg); color: var(--accent); padding: 3px 10px; border-radius: 5px; font-size: 10px; font-weight: 700; border: 1px solid var(--accent);">
                                v1.0
                            </span>
                            <span
                                style="background: rgba(245, 158, 11, 0.15); color: #f59e0b; padding: 3px 10px; border-radius: 5px; font-size: 10px; font-weight: 700; border: 1px solid #f59e0b;">
                                RC
                            </span>
                        </div>
                        <div style="text-align: right; font-style: italic; opacity: 0.7;">
                            "Soli Deo Gloria"
                        </div>
                    </div>

                </div>
            </div>

            <!-- SCRIPTS -->
            <script src="js/bibles/bible_rv1960.js"></script>
            <script>
                // Asignar RV1960 como bibleSource por defecto
                var bibleSource = bibleSource_RV1960;
            </script>
            <script src="js/bible-versions.js?v=BIBLE_SYNC_FIX_V1"></script>
            <script src="js/zion-room-system.js"></script>
            <script src="js/zion-bible-navigator.js?v=2"></script>
            <script src="js/zion-tutorial.js?v=1"></script>
            <script src="js/zion-panel.js?v=PANEL_THEME_FIX_V5"></script>
            <script src="js/zion-theme-selector.js?v=PANEL_THEME_FIX_V5"></script>
            <script>
                // Init Logic moved to zion-panel.js

                // Toggle Configuration Drawer
                function toggleConfigDrawer() {
                    const drawer = document.getElementById('configDrawer');
                    const isOpen = drawer.style.transform === 'translateY(0%)';
                    drawer.style.transform = isOpen ? 'translateY(100%)' : 'translateY(0%)';
                }



                // Toggle Unsplash Modal
                function toggleUnsplashModal() {
                    const modal = document.getElementById('unsplashModal');
                    if (modal.style.display === 'none' || !modal.style.display) {
                        modal.style.display = 'flex';
                        setTimeout(() => modal.style.opacity = '1', 10);

                        // Sugerencias automáticas por defecto (ej: worship) si no hay búsqueda previa
                        if (!currentQuery) {
                            setTimeout(() => {
                                quickSearch('worship');
                            }, 500);
                        }
                    } else {
                        modal.style.opacity = '0';
                        setTimeout(() => modal.style.display = 'none', 300);
                    }
                }

                // Unsplash API Configuration
                const UNSPLASH_ACCESS_KEY = 'wJMZZX8FpwpZirlDF66IRsZp6q4P70EsVbD3UaVFlKo';

                // Pagination state
                let currentPage = 1;
                let currentQuery = '';
                let totalPages = 1;

                // Quick Search
                function quickSearch(term) {
                    document.getElementById('unsplashSearch').value = term;
                    searchUnsplash();
                }

                // Search Unsplash
                async function searchUnsplash(page = 1) {
                    const query = document.getElementById('unsplashSearch').value.trim();
                    if (!query) {
                        alert('Por favor ingresa un término de búsqueda');
                        return;
                    }

                    currentQuery = query;
                    currentPage = page;

                    const loading = document.getElementById('unsplashLoading');
                    const results = document.getElementById('unsplashResults');
                    const pagination = document.getElementById('unsplashPagination');

                    loading.style.display = 'flex';
                    results.innerHTML = '';

                    try {
                        const response = await fetch(
                            `https://api.unsplash.com/search/photos?query=${encodeURIComponent(query)}&per_page=10&page=${page}&client_id=${UNSPLASH_ACCESS_KEY}`
                        );

                        if (!response.ok) throw new Error('Error al buscar imágenes');

                        const data = await response.json();

                        loading.style.display = 'none';

                        if (data.results.length === 0) {
                            results.innerHTML = `
                                <div style="grid-column: 1 / -1; text-align: center; color: var(--text-muted); padding: 40px;">
                                    No se encontraron imágenes para "${query}"
                                </div>
                            `;
                            pagination.style.display = 'none';
                            return;
                        }

                        // Calculate total pages
                        totalPages = Math.ceil(data.total / 10);

                        data.results.forEach(photo => {
                            const card = document.createElement('div');
                            card.style.cssText = `
                                position: relative;
                                border-radius: 12px;
                                overflow: hidden;
                                cursor: pointer;
                                transition: all 0.3s;
                                border: 2px solid transparent;
                            `;

                            card.innerHTML = `
                                <img src="${photo.urls.small}" 
                                    alt="${photo.alt_description || 'Unsplash photo'}"
                                    style="width: 100%; height: 100%; object-fit: cover; display: block; filter: brightness(0.9);">
                                <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); padding: 10px; color: white; font-size: 0.7rem;">
                                    Por ${photo.user.name}
                                </div>
                            `;

                            card.onmouseover = () => {
                                card.style.transform = 'scale(1.05)';
                                card.style.borderColor = 'var(--accent)';
                                card.style.boxShadow = '0 8px 20px var(--brand-glow)';
                            };

                            card.onmouseout = () => {
                                card.style.transform = 'scale(1)';
                                card.style.borderColor = 'transparent';
                                card.style.boxShadow = 'none';
                            };

                            card.onclick = () => selectBackground(photo.urls.regular, photo.user.name, photo.links.html);

                            results.appendChild(card);
                        });

                        // Update pagination
                        pagination.style.display = 'flex';
                        document.getElementById('pageInfo').textContent = `Página ${currentPage} de ${totalPages}`;
                        document.getElementById('btnPrevPage').disabled = currentPage === 1;
                        document.getElementById('btnNextPage').disabled = currentPage === totalPages;

                        // Update button styles based on disabled state
                        const btnPrev = document.getElementById('btnPrevPage');
                        const btnNext = document.getElementById('btnNextPage');

                        if (currentPage === 1) {
                            btnPrev.style.opacity = '0.5';
                            btnPrev.style.cursor = 'not-allowed';
                        } else {
                            btnPrev.style.opacity = '1';
                            btnPrev.style.cursor = 'pointer';
                        }

                        if (currentPage === totalPages) {
                            btnNext.style.opacity = '0.5';
                            btnNext.style.cursor = 'not-allowed';
                        } else {
                            btnNext.style.opacity = '1';
                            btnNext.style.cursor = 'pointer';
                        }

                    } catch (error) {
                        loading.style.display = 'none';
                        results.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; color: var(--danger); padding: 40px;">
                                Error al cargar imágenes. Por favor intenta de nuevo.
                            </div>
                        `;
                        console.error('Unsplash error:', error);
                    }
                }

                // Change Page
                function changePage(direction) {
                    const newPage = currentPage + direction;
                    if (newPage >= 1 && newPage <= totalPages) {
                        searchUnsplash(newPage);
                    }
                }

                // --- SISTEMA DE FONDOS LOCALES ---

                let selectedLocalBgData = null;

                // Cambiar entre pestañas
                function switchBgTab(tab) {
                    const unsplashCont = document.getElementById('unsplashContent');
                    const localCont = document.getElementById('localContent');
                    const tabUnsplash = document.getElementById('tabUnsplash');
                    const tabLocal = document.getElementById('tabLocal');

                    if (tab === 'unsplash') {
                        unsplashCont.style.display = 'flex';
                        localCont.style.display = 'none';
                        tabUnsplash.style.background = 'var(--accent)';
                        tabUnsplash.style.color = '#000';
                        tabLocal.style.background = 'transparent';
                        tabLocal.style.color = '#fff';
                    } else {
                        unsplashCont.style.display = 'none';
                        localCont.style.display = 'flex';
                        tabUnsplash.style.background = 'transparent';
                        tabUnsplash.style.color = '#fff';
                        tabLocal.style.background = 'var(--accent)';
                        tabLocal.style.color = '#000';
                    }
                }

                // Manejar carga de archivo local
                function handleLocalBgUpload(input) {
                    const file = input.files[0];
                    if (!file) return;

                    // Validar tamaño (50MB)
                    if (file.size > 50 * 1024 * 1024) {
                        alert('La imagen es demasiado pesada (máximo 50MB). Intenta con una imagen optimizada.');
                        return;
                    }

                    const reader = new FileReader();
                    const loading = document.getElementById('unsplashLoading');
                    const loadingText = document.getElementById('loadingText');

                    loadingText.textContent = 'Procesando imagen...';
                    loading.style.display = 'flex';

                    reader.onload = (e) => {
                        const dataUrl = e.target.result;
                        selectedLocalBgData = dataUrl;

                        // Mostrar preview
                        const placeholder = document.getElementById('uploadPlaceholder');
                        const preview = document.getElementById('uploadPreview');
                        const previewImg = document.getElementById('bgPreviewImg');
                        const applyBtn = document.getElementById('applyLocalBtn');

                        previewImg.src = dataUrl;
                        placeholder.style.display = 'none';
                        preview.style.display = 'block';
                        applyBtn.style.display = 'block';

                        loading.style.display = 'none';
                    };

                    reader.onerror = () => {
                        loading.style.display = 'none';
                        alert('Error al leer el archivo. Intenta con otro formato.');
                    };

                    reader.readAsDataURL(file);
                }

                // Aplicar fondo local
                function applyLocalBackground() {
                    if (!selectedLocalBgData) return;

                    selectBackground(selectedLocalBgData, 'Mi Equipo', null);

                    // Resetear estado del modal
                    setTimeout(() => {
                        const placeholder = document.getElementById('uploadPlaceholder');
                        const preview = document.getElementById('uploadPreview');
                        const applyBtn = document.getElementById('applyLocalBtn');
                        placeholder.style.display = 'block';
                        preview.style.display = 'none';
                        applyBtn.style.display = 'none';
                        selectedLocalBgData = null;
                        document.getElementById('localBgInput').value = '';
                    }, 500);
                }

                // --- FIN SISTEMA DE FONDOS LOCALES ---

                // Select Background
                function selectBackground(imageUrl, photographer, photoLink) {
                    // Enviar al overlay
                    const payload = {
                        type: 'zion:background',
                        payload: {
                            url: imageUrl,
                            photographer: photographer,
                            link: photoLink
                        }
                    };

                    // Enviar vía Socket.IO
                    if (typeof socket !== 'undefined') {
                        socket.emit('dispatch', payload);
                    }

                    // Enviar vía BroadcastChannel
                    if (typeof bc !== 'undefined') {
                        bc.postMessage(payload);
                    }

                    // Feedback visual
                    toggleUnsplashModal();

                    // Mostrar notificación
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 80px;
                        right: 20px;
                        background: var(--accent);
                        color: #000;
                        padding: 15px 25px;
                        border-radius: 8px;
                        font-weight: 700;
                        z-index: 30000;
                        animation: slideIn 0.3s ease;
                    `;
                    notification.textContent = '✓ Fondo aplicado';
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transition = 'opacity 0.3s';
                        setTimeout(() => notification.remove(), 300);
                    }, 2000);
                }

                // Remove Background
                function removeBackground() {
                    const payload = {
                        type: 'zion:background',
                        payload: {
                            url: null,
                            photographer: null,
                            link: null
                        }
                    };

                    if (typeof socket !== 'undefined') {
                        socket.emit('dispatch', payload);
                    }

                    if (typeof bc !== 'undefined') {
                        bc.postMessage(payload);
                    }

                    toggleUnsplashModal();

                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 80px;
                        right: 20px;
                        background: var(--accent);
                        color: #000;
                        padding: 15px 25px;
                        border-radius: 8px;
                        font-weight: 700;
                        z-index: 30000;
                        animation: slideIn 0.3s ease;
                    `;
                    notification.textContent = '✓ Fondo removido';
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transition = 'opacity 0.3s';
                        setTimeout(() => notification.remove(), 300);
                    }, 2000);
                }

                // Función para el Modal de Contacto (Importada de Zion Presenter)
                function toggleContactModal() {
                    const modal = document.getElementById('contactModal');
                    if (modal.style.display === 'none' || modal.style.display === '') {
                        modal.style.display = 'flex';
                        setTimeout(() => modal.style.opacity = '1', 10);
                    } else {
                        modal.style.opacity = '0';
                        setTimeout(() => modal.style.display = 'none', 500);
                    }
                }

                function closeModal(modalId) {
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.style.opacity = '0';
                        setTimeout(() => modal.style.display = 'none', 500);
                    }
                }

                // Modal de Créditos (Zion Cast)
                function showAboutModal() {
                    const modal = document.getElementById('aboutOverlay');
                    if (modal) {
                        modal.style.display = 'flex';
                        setTimeout(() => modal.style.opacity = '1', 10);
                    }
                }

                // --- CONTROL DEL MONITOR EN VIVO ---
                function initMonitor() {
                    const monitorIframe = document.getElementById('monitorIframe');
                    // En modo local siempre usamos MAIN
                    const roomCode = 'MAIN';
                    if (monitorIframe) {
                        // Usamos un pequeño delay para que la sala esté totalmente lista en el server
                        setTimeout(() => {
                            monitorIframe.src = `zion_overlay.html?monitor=true`; // Quitamos el ?room=
                            console.log("📺 Monitor local iniciado");
                        }, 500);
                    }
                }

                function resizeMonitor() {
                    const wrapper = document.querySelector('.monitor-wrapper');
                    const iframe = document.getElementById('monitorIframe');
                    if (!wrapper || !iframe) return;
                    const scale = wrapper.clientWidth / 1280;
                    iframe.style.transform = `scale(${scale})`;
                }

                window.addEventListener('resize', resizeMonitor);

                // Inicializar monitor cuando el Room System esté listo
                const monitorInterval = setInterval(() => {
                    if (window.currentRoomCode) {
                        initMonitor();
                        resizeMonitor();
                        clearInterval(monitorInterval);
                    }
                }, 500);
            </script>
    </body>

</html>

</html>