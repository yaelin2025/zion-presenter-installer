/* --- ZION CAST STYLE SYSTEM (v1.3 Dynamic) --- */

:root {
    /* Default Colors (Dark Mode Overlay) */
    --text-primary: #ffffff;
    --glass-border: rgba(255, 255, 255, 0.1);

    /* --- VARIABLES DINÁMICAS (Valores por JS) --- */

    /* 1. CENTRO */
    --c-w: 1100px;
    --c-h: 400px;
    --c-x: 0px;
    --c-y: 0px;
    --c-op: 0.50;
    --c-scale: 0.92;

    /* 2. TITULO */
    --t-w: auto;
    --t-h: 70px;
    --t-x: 0px;
    --t-y: 50px;
    --t-op: 0.50;
    --t-scale: 0.92;

    /* 3. PREDICADOR (BL) */
    --bl-w: auto;
    --bl-h: 60px;
    --bl-x: 50px;
    --bl-y: 50px;
    --bl-op: 0.50;
    --bl-scale: 0.92;

    /* 4. ULTIMA CITA (BR) */
    --br-w: auto;
    --br-h: 60px;
    --br-x: 50px;
    --br-y: 50px;
    --br-op: 0.50;
    --br-scale: 0.92;

    /* 5. CITA BASE (CB) */
    --cb-w: auto;
    --cb-h: 60px;
    --cb-x: 0px;
    --cb-y: 40px;
    --cb-op: 0.50;
    --cb-scale: 0.92;

    /* 6. RADIOS DE CURVATURA (NUEVO) */
    --c-radius: 30px;
    /* Radio para el Central (Independiente) */
    --g-radius: 100px;
    /* Radio Global para los demás (Etiquetas) */

    /* Colores de Acento - Gama de Azules */
    --accent-cyan: #00e5ff;
    --accent-blue-mid: #0ea5e9;
    --accent-blue-deep: #2563eb;

    /* 7. BIBLIA (MODO VERSICULO) */
    --verse-w: 90vw;
    --verse-h: 80vh;
    --verse-x: 5vw;
    --verse-y: 10vh;
    --verse-padding: 60px;
    --verse-opacity: 0.88;
    --verse-citation-size: 2.6rem;
    --global-shadow: 0.5;
    --bg-darkness: 0.5;
    /* Oscuridad del fondo (0 = sin oscuridad, 1 = negro total) */
}

/* Base Reset */
* {
    box-sizing: border-box !important;
}

html,
body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: transparent !important;
    overflow: hidden;
    font-family: 'Bebas Neue', sans-serif;
}

/* Capa oscura sobre el fondo */
body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, var(--bg-darkness, 0.5));
    z-index: -1;
    pointer-events: none;
    transition: background 0.3s ease;
}

/* BACKGROUND LAYERS */
.bg-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    z-index: -2;
    transition: opacity 0.7s ease-in-out;
    pointer-events: none;
}

/* --- MAIN APP CONTAINER --- */
/* Hide content until initialized to prevent styling jumps */
#app-container {
    opacity: 0.01;
    /* Quasi-invisible but ready */
    transition: opacity 0.1s ease-in;
}

#app-container.ready {
    opacity: 1;
}

/* --- CLASE UNIT (Contenedor y Posicionamiento) --- */
/* Cada unidad se posiciona usando sus variables específicas */
/* IMPORTANTE: Quitamos overflow:hidden para permitir sombras externas suaves */

/* CENTRO: Absoluto al centro */
.center-unit {
    position: absolute;
    left: 50%;
    top: 50%;
    width: var(--c-w);
    height: var(--c-h);

    /* Configuración de Radio Local (Recibida de JS: --c-radius) */
    --radius: var(--c-radius, 30px);

    max-width: var(--c-max-w, var(--c-w));
    max-height: var(--c-h);

    --current-scale: var(--c-scale);
    transform: translate(calc(-50% + var(--c-x)), calc(-50% + var(--c-y))) scale(calc(var(--current-scale) * 0.9));
    --bg-alpha: var(--c-op);
}

.title-unit {
    position: absolute;
    left: 50%;
    top: 0;
    width: var(--t-w);
    height: var(--t-h);

    /* Variable espefica del título recibida por JS */
    --radius: var(--t-radius, 100px);

    max-width: var(--t-max-w, var(--t-w));
    max-height: var(--t-h);

    --current-scale: var(--t-scale);
    transform: translate(calc(-50% + var(--t-x)), var(--t-y)) scale(calc(var(--current-scale) * 0.9));
    --bg-alpha: var(--t-op);
    z-index: 10;
}

/* PREDICADOR (BL): Abajo Izquierda */
.bl-unit {
    position: absolute;
    left: 0;
    bottom: 0;
    width: var(--bl-w);
    height: var(--bl-h);

    --radius: var(--bl-radius, 100px);

    max-width: var(--bl-max-w, var(--bl-w));
    max-height: var(--bl-h);

    --current-scale: var(--bl-scale);
    transform: translate(var(--bl-x), calc(var(--bl-y) * -1)) scale(calc(var(--current-scale) * 0.9));
    --bg-alpha: var(--bl-op);
}

/* ULTIMA CITA (BR): Abajo Derecha */
.br-unit {
    position: absolute;
    right: 0;
    bottom: 0;
    width: var(--br-w);
    height: var(--br-h);

    --radius: var(--br-radius, 100px);

    max-width: var(--br-max-w, var(--br-w));
    max-height: var(--br-h);

    --current-scale: var(--br-scale);
    transform: translate(calc(var(--br-x) * -1), calc(var(--br-y) * -1)) scale(calc(var(--current-scale) * 0.9));
    --bg-alpha: var(--br-op);
}

/* CITA BASE (CB): Abajo Centro */
.cb-unit {
    position: absolute;
    left: 50%;
    bottom: 0;
    width: var(--cb-w);
    height: var(--cb-h);

    --radius: var(--cb-radius, 100px);

    max-width: var(--cb-max-w, var(--cb-w));
    max-height: var(--cb-h);

    --current-scale: var(--cb-scale);
    transform: translate(calc(-50% + var(--cb-x)), calc(var(--cb-y) * -1)) scale(calc(var(--current-scale) * 0.9));
    --bg-alpha: var(--cb-op);
}

/* --- ANIMACIÓN PREMIUM DE BARRAS/GLOBOS --- */
@keyframes fxUnitIn {
    0% {
        opacity: 0;
        transform: var(--base-transform) scale(0.7);
        filter: blur(15px);
    }

    100% {
        opacity: 1;
        transform: var(--base-transform) scale(var(--current-scale));
        filter: blur(0);
    }
}

@keyframes fxUnitOut {
    0% {
        opacity: 1;
        transform: var(--base-transform) scale(var(--current-scale));
        filter: blur(0);
    }

    100% {
        opacity: 0;
        transform: var(--base-transform) scale(0.8);
        filter: blur(15px);
    }
}

.unit {
    opacity: 0;
    will-change: opacity, transform, filter;
    pointer-events: none;
    display: flex;
    justify-content: center;
    align-items: center;

    /* Transition for mode switching (when class is added/removed without playAnim) */
    transition: opacity 0.6s ease, transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.6s ease;

    /* Si no hay animación activa, se queda en el transform base */
    transform: var(--base-transform) scale(calc(var(--current-scale) * 0.9));
}

.fx-in {
    animation: fxUnitIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    pointer-events: auto;
}

.fx-out {
    animation: fxUnitOut 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    pointer-events: none;
}

/* ANIMACION Y ESTADO VISIBLE (Legacy support) */
.unit.is-shown {
    opacity: 1;
    transform: var(--base-transform) scale(var(--current-scale));
    pointer-events: auto;
}

/* --- MONITOR/DEBUG MODE: Ver globos desactivados en rojo --- */
body.is-monitor-mode .unit {
    transition: all 0.3s ease !important;
}

body.is-monitor-mode .unit:not(.is-shown),
body.is-monitor-mode .unit.is-hidden {
    opacity: 0.6 !important;
    transform: var(--base-transform) scale(var(--current-scale)) !important;
    pointer-events: none;
    animation: none !important;
}

body.is-monitor-mode .unit:not(.is-shown) .glass-panel,
body.is-monitor-mode .unit.is-hidden .glass-panel {
    background: rgba(220, 38, 38, 0.25) !important;
    /* Rojo traslúcido */
    border: 2px dashed #ef4444 !important;
    /* Borde rojo vibrante */
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
}

body.is-monitor-mode .unit:not(.is-shown) .glass-panel::after,
body.is-monitor-mode .unit.is-hidden .glass-panel::after {
    content: 'INVISIBLE';
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: #ef4444;
    color: white;
    font-size: 8px;
    padding: 1px 6px;
    border-radius: 4px;
    font-weight: 800;
    letter-spacing: 1px;
}

/* Definimos la 'base-transform' localmente en cada unit para que el 'is-shown' sepa a donde volver */
/* Y definimos el ORIGEN de la transformación para que crezcan hacia el lado correcto */
.center-unit {
    --base-transform: translate(calc(-50% + var(--c-x)), calc(-50% + var(--c-y)));
    transform-origin: center center;
}

.title-unit {
    --base-transform: translate(calc(-50% + var(--t-x)), var(--t-y));
    transform-origin: top center;
}

.bl-unit {
    --base-transform: translate(var(--bl-x), calc(var(--bl-y) * -1));
    transform-origin: bottom left;
}

.br-unit {
    --base-transform: translate(calc(var(--br-x) * -1), calc(var(--br-y) * -1));
    transform-origin: bottom right;
}

.cb-unit {
    --base-transform: translate(calc(-50% + var(--cb-x)), calc(var(--cb-y) * -1));
    transform-origin: bottom center;
}


/* --- GLASS PANEL (Visual) --- */
/* --- GLASS PANEL (Visual Ecosystem Match) --- */
/* --- MATERIAL CARD PANEL (Visual) --- */
.glass-panel {
    width: 100%;
    height: 100%;
    /* Tinted Glass Background matching Presenter logic */
    background: color-mix(in srgb, var(--accent, #00b0ff), rgba(15, 15, 20, 0.95) 85%);
    background-color: rgba(15, 15, 20, var(--bg-alpha, 0.85));
    /* Fallback and alpha control */
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius, 8px);

    /* Material Elevation (Shadow) */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5), 0 10px 20px rgba(0, 0, 0, 0.3);



    display: flex;
    flex-direction: column;
    justify-content: center;
    /* Centrado vertical por defecto (solo center usa flex-start) */
    align-items: center;
    text-align: center;

    position: relative;
    overflow: hidden;
    /* Mantener contenido dentro del panel */
}



/* EFECTO "DYNAMIC FLOW" (Animación Neón Cíclica) */
.glass-panel .border-glow {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 4px;
    z-index: 10;
    border-radius: 0 0 var(--radius) var(--radius);

    /* TÉCNICA DE DUPLICIDAD EXACTA PARA LOOP INFINITO */
    background: linear-gradient(90deg,
            var(--accent-cyan) 0%,
            var(--accent-blue-mid) 16.66%,
            var(--accent-blue-deep) 33.33%,
            var(--accent-cyan) 50%,
            var(--accent-blue-mid) 66.66%,
            var(--accent-blue-deep) 83.33%,
            var(--accent-cyan) 100%);
    background-size: 200% 100%;

    animation: borderFlow 8s linear infinite;
    opacity: 0.9;
    box-shadow: 0 -2px 10px var(--accent-cyan);
}

@keyframes kfNeonBreathe {

    0%,
    100% {
        filter: brightness(1) drop-shadow(0 0 2px rgba(0, 229, 255, 0.2));
    }

    50% {
        filter: brightness(1.5) drop-shadow(0 0 10px rgba(0, 229, 255, 0.6));
    }
}

/* Solo el CENTRO tiene borde grueso */
.center-unit .glass-panel .border-glow {
    height: 6px;
    animation-duration: 6s;
    /* Más rápido en el centro */
}

/* DESINCRONIZACIÓN DEL LATIDO (Each at its own time) */
.title-unit .border-glow {
    animation-delay: -1.2s;
    animation-duration: 9s;
}

.bl-unit .border-glow {
    animation-delay: -0.5s;
    animation-duration: 10s;
}

.br-unit .border-glow {
    animation-delay: -2.3s;
    animation-duration: 7s;
}

.cb-unit .border-glow {
    animation-delay: -3.1s;
    animation-duration: 11s;
}

/* --- LAYER 1: DELETED (Synced Blur) --- */
/* Eliminado para estabilidad visual y uso con fuentes OBS nativas */

/* --- LAYER 2: TINT (Darkness Control) --- */
/* Optimized: Opacity change is instant and cheap */
/* Removed Tint Layer logic as background is now solid */
.glass-panel::after {
    display: none;
}

/* Stronger Vignette for Center Unit (Targeting Layer 2 directly now?) */
/* Opcional: Si quieres vignette, agrégalo al ::after o al contenedor principal */
.center-unit .glass-panel {
    box-shadow: inset 0 0 50px 20px rgba(10, 10, 15, 0.5);
    /* Sombra interna directa */
}


@keyframes borderFlow {
    from {
        background-position: 0% 50%;
    }

    to {
        background-position: 100% 50%;
    }
}

.text-content {
    color: var(--text-primary);
    /* SOMBRA GLOBAL DINÁMICA */
    text-shadow:
        0 calc(4px * var(--global-shadow, 0.5)) calc(12px * var(--global-shadow, 0.5)) rgba(0, 0, 0, 0.9),
        0 0 calc(25px * var(--global-shadow, 0.5)) rgba(0, 229, 255, 0.25);
    line-height: 1.1;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* NÚMERO DE VERSÍCULO (Custom Span) */
.text-content .v-num {
    display: inline-block;
    font-size: 0.65em;
    vertical-align: top;
    transform: translateY(2px);
    opacity: 0.8;
    margin-right: 0.25em;
    font-weight: bold;
    color: var(--accent);
}

/* GEOMETRÍA INTERNA EXTRA */
.center-unit .glass-panel {
    position: relative;
    padding: var(--c-pad-y, 40px) var(--c-pad-x, 60px);

    /* FLEXBOX para alineación */
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    /* NO center - evita overflow */
    align-items: center;
    /* Centrado horizontal */

    overflow: hidden;
    /* CRITICAL: Evitar que se salga */
}

.center-unit .text-content {
    /* ARQUITECTURA SIMPLE Y FUNCIONAL */
    position: relative;
    width: auto;
    max-width: 100%;

    /* Centrado vertical con margin auto dentro de flexbox */
    margin: auto 0;

    display: block;
    overflow: visible;
    /* Para poder medir en JS */

    font-family: 'Bebas Neue', sans-serif;
    font-size: 56px;
    letter-spacing: 1px;
    line-height: 1.1;
    text-align: center;
    word-wrap: break-word;
}

/* Ajuste visual: Padding Top para bajar el texto y compensar la linea neon */
.title-unit .glass-panel {
    padding: var(--t-pad-y, 0) var(--t-pad-x, 30px);
    padding-top: 5px;
}

.bl-unit .glass-panel {
    padding: var(--bl-pad-y, 0) var(--bl-pad-x, 15px);
    padding-top: 5px;
}

.br-unit .glass-panel {
    padding: var(--br-pad-y, 0) var(--br-pad-x, 15px);
    padding-top: 5px;
}

.cb-unit .glass-panel {
    padding: var(--cb-pad-y, 0) var(--cb-pad-x, 15px);
    padding-top: 5px;
}

/* Revertir fuentes a tamaños fijos y ajustar centro óptico */
.title-unit .text-content {
    font-size: 46px;
    letter-spacing: 2px;
    white-space: nowrap;
    line-height: 1;
    /* Sin Transformaciones raras */
}

.bl-unit .text-content,
.br-unit .text-content,
.cb-unit .text-content {
    font-size: 32px;
    /* Increased from 24px */
    white-space: nowrap;
    line-height: 1;
    /* Sin Transformaciones raras */
}

/* Animación Pulse Dinámica */
@keyframes kfPulse {
    0% {
        transform: var(--base-transform) scale(var(--current-scale));
    }

    50% {
        transform: var(--base-transform) scale(calc(var(--current-scale) * 1.05));
    }

    50% {
        transform: var(--base-transform) scale(calc(var(--current-scale) * 1.05));
    }

    100% {
        transform: var(--base-transform) scale(var(--current-scale));
    }
}

.fx-pulse {
    animation: kfPulse 0.3s ease-out;
}

/* PULSE HEAVY (Salto más notorio para 'br') */
@keyframes kfPulseHeavy {
    0% {
        transform: var(--base-transform) scale(var(--current-scale));
    }

    40% {
        transform: var(--base-transform) scale(calc(var(--current-scale) * 1.15));
        filter: brightness(1.3);
    }

    100% {
        transform: var(--base-transform) scale(var(--current-scale));
        filter: brightness(1);
    }
}

.fx-pulse-heavy {
    animation: kfPulseHeavy 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* --- TEXT TRANSITIONS (Blur Effect) --- */
@keyframes kfBlurOut {
    0% {
        opacity: 1;
        filter: blur(0);
        transform: scale(1);
    }

    100% {
        opacity: 0;
        filter: blur(10px);
        transform: scale(0.95);
    }
}

@keyframes kfBlurIn {
    0% {
        opacity: 0;
        filter: blur(10px);
        transform: scale(1.05);
    }

    100% {
        opacity: 1;
        filter: blur(0);
        transform: scale(1);
    }
}

.text-exit {
    animation: kfBlurOut 0.2s ease-in forwards;
}

.text-enter {
    animation: kfBlurIn 0.3s ease-out forwards;
}

/* --- DINAMISMO ASINCRÓNICO REMOVED (Background Sync Deleted) --- */

/* --- HIGHLIGHT (Resaltado de Palabras: *texto*) --- */
.highlight {
    /* Base Neon */
    font-weight: bold;
    color: #fff;
    /* Fallback */

    /* SHIMMER EFFECT */
    background: linear-gradient(110deg, #00e5ff 20%, #ffffff 50%, #00e5ff 80%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    background-clip: text;
    /* Standard property */
    -webkit-text-fill-color: transparent;

    /* Mantener shadow para el glow, aunque text-fill sea transparent, el shadow viaja con la forma */
    text-shadow: 0 0 15px rgba(0, 229, 255, 0.6);

    animation: kfShimmer 3s linear infinite;
}

@keyframes kfShimmer {
    to {
        background-position: 200% center;
    }
}

/* --- CITATION LABEL (Standalone Element) --- */
.citation-badge {
    position: absolute;
    /* Default: Bottom Left (user req switch) */
    bottom: var(--badge-y, 30px);
    left: var(--badge-x, 30px);
    top: auto;
    right: auto;

    transform-origin: center;

    /* INITIAL STATE (Hidden) */
    opacity: 0;
    transform: scale(0.6);
    /* Start smaller for growth effect */

    font-family: 'Barlow Condensed', sans-serif;
    font-size: 22px;
    font-weight: 700;
    letter-spacing: 1px;
    color: #fff;
    text-transform: uppercase;

    /* Pill Badge Style */
    background: rgba(0, 0, 0, var(--badge-opacity, 0.7));
    padding: 6px 20px;
    border-radius: var(--badge-radius, 50px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);

    pointer-events: none;
    z-index: 20;

    /* REFINED TRANSITION */
    transition:
        opacity 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
        transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* CITATION LAYER 1: DELETED (Blur) */

/* CITATION LAYER 2: TINT */

/* CITATION LAYER 2: TINT */
.citation-badge::after {
    content: '';
    position: absolute;
    inset: 0;
    z-index: -1;
    /* Usamos la variable de opacidad controlada por el slider */
    background-color: rgba(10, 10, 15, var(--badge-opacity, 0.9));
    border-radius: inherit;
    transition: background-color 0.2s;
}

/* Badge Text */
.citation-badge span {
    position: relative;
    z-index: 5;
}


@keyframes kfBadgePop {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }

    100% {
        opacity: 1;
        transform: scale(1);
        /* We rely on var(--badge-scale) in the main rule */
    }
}

/* VISIBLE STATE */
.center-unit.is-verse .citation-badge {
    opacity: 1;
    transform: scale(var(--badge-scale, 1));
}

/* EXIT STATE (Triggered by JS) */
.center-unit.is-verse-exit .citation-badge {
    opacity: 0;
    transform: scale(0.6);
}

/* --- VERSE MODE (Modo Lectura) --- */

/* Tag Style for Citation inside text */
.verse-ref {
    display: inline-block;
    margin-top: 20px;
    font-size: 0.6em;
    /* Relative to parent font size */
    background: var(--accent-cyan);
    color: #000;
    padding: 5px 20px;
    border-radius: 50px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 0 20px rgba(0, 229, 255, 0.4);
    transform: translateY(-5px);
}

/* --- NEW DEDICATED VERSE LAYER --- */

/* --- TRANSICIONES DE MODO (CAST <-> VERSE) --- */

/* CAPA DE VERSÍCULO: Estado base (Oculto) */
.verse-layer {
    position: fixed;
    top: var(--verse-y, 10vh);
    left: var(--verse-x, 5vw);
    width: var(--verse-w, 90vw);
    height: var(--verse-h, 80vh);
    z-index: 999;
    pointer-events: none;

    /* Base invisible */
    opacity: 0;
    transform: scale(0.95);
    filter: blur(15px);

    /* Salida equilibrada y ágil (0.5s) */
    transition:
        opacity 0.5s ease-in,
        transform 0.5s ease-in,
        filter 0.5s ease-in;
    transition-delay: 0s;

    will-change: opacity, transform, filter;

    display: flex;
    justify-content: center;
    align-items: center;
}

/* CAPA DE VERSÍCULO: Al activar modo Biblia */
body.mode-verse .verse-layer {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    visibility: visible;
    pointer-events: auto;

    /* ENTRA ANTES: Aparece casi de inmediato (0.1s) */
    transition:
        opacity 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
        transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
        filter 0.8s ease-out;
    transition-delay: 0.1s;
}

/* GLOBOS DE CAST: Al entrar en modo Versículo (LA SALIDA) */
body.mode-verse .unit.is-shown {
    /* Ejecutar zoom out siempre al cambiar a Biblia */
    animation: fxUnitOut 0.5s forwards !important;
    pointer-events: none !important;
}

/* Retorno limpio: Sin delays globales que rompan el uso normal del panel */
body:not(.mode-verse) .unit.is-shown {
    opacity: 1;
    transform: var(--base-transform) scale(var(--current-scale));
}

/* --- APP CONTAINER MODE TRANSITIONS --- */

/* Hide MAIN APP container when in Verse Mode for safety and layered sync */
body.mode-verse #app-container {
    opacity: 0 !important;
    pointer-events: none !important;
    /* Sync with unit exit animation (0.5s) */
    transition: opacity 0.5s ease-in !important;
    transition-delay: 0s !important;
}

/* Return to Cast - Fast overlap (0.3s delay) */
body:not(.mode-verse) #app-container {
    transition: opacity 0.6s ease-out;
    transition-delay: 0.3s;
    /* Adjusted for the faster 0.5s verse exit */
}


.verse-glass-panel {
    /* FIXED dimensions - back to full size */
    width: 100%;
    height: 100%;
    max-width: none;
    max-height: none;

    /* Match cast balloon glassmorphism style */
    background: rgba(15, 15, 20, var(--verse-opacity, 0.85));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 35px;

    /* Material Elevation (Shadow) - same as cast balloons */
    box-shadow:
        0 4px 10px rgba(0, 0, 0, 0.5),
        0 10px 20px rgba(0, 0, 0, 0.3);

    /* No padding here - handled by inner elements */
    padding: 0;

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    position: relative;

    /* Fixed size - text will adapt */
    overflow: hidden;
    /* Clip the bottom neon line */
    box-sizing: border-box;
}

/* Specific style for Verse bottom glow */
.verse-glass-panel .border-glow {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 8px;
    /* Un poco más grueso para impacto */
    z-index: 10;
    border-radius: 0 0 35px 35px;

    /* TÉCNICA DE DUPLICIDAD EXACTA PARA LOOP INFINITO */
    background: linear-gradient(90deg,
            var(--accent-cyan) 0%,
            var(--accent-blue-mid) 16.66%,
            var(--accent-blue-deep) 33.33%,
            var(--accent-cyan) 50%,
            var(--accent-blue-mid) 66.66%,
            var(--accent-blue-deep) 83.33%,
            var(--accent-cyan) 100%);
    background-size: 200% 100%;

    animation: borderFlow 12s linear infinite;
    /* Un poco más lento y solemne */
    opacity: 1;
    box-shadow: 0 -4px 20px rgba(0, 229, 255, 0.5);
}

/* Full glow ::before removed, using .border-glow instead */

.verse-content {
    font-family: 'Bebas Neue', sans-serif;
    color: #fff;
    /* Font size will be set dynamically by JS */
    line-height: 1.15;

    /* PREMIUN DYNAMIC SHADOW */
    text-shadow:
        0 calc(4px * var(--global-shadow)) calc(15px * var(--global-shadow)) rgba(0, 0, 0, calc(0.8 * var(--global-shadow))),
        0 0 calc(30px * var(--global-shadow)) rgba(0, 229, 255, calc(0.2 * var(--global-shadow)));

    /* Zion Balanced Padding - Dinámico */
    padding: var(--verse-padding, 5%);
    box-sizing: border-box;

    width: 100%;
    height: 100%;
    flex: 1;

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;

    /* Allow text to wrap */
    word-wrap: break-word;
    overflow-wrap: break-word;
}

.verse-citation-tag {
    /* PREMIUN DYNAMIC SHADOW (Synchronized with content) */
    text-shadow:
        0 calc(2px * var(--global-shadow)) calc(10px * var(--global-shadow)) rgba(0, 0, 0, calc(0.9 * var(--global-shadow))),
        0 0 calc(20px * var(--global-shadow)) rgba(0, 229, 255, calc(0.15 * var(--global-shadow)));
}

@keyframes verseTextAppear {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.verse-citation-tag {
    position: absolute;
    bottom: 25px;
    /* Adjusted slightly for larger text */
    right: 45px;

    background: none;
    color: rgba(255, 255, 255, 0.95);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: var(--verse-citation-size, 2.6rem);
    /* Bigger as requested */
    padding: 0;
    text-transform: uppercase;
    letter-spacing: 1.5px;

    /* Using dynamic shadow from the previous block */
    display: block;
    z-index: 20;
}

@keyframes citationAppear {
    from {
        opacity: 0;
        transform: translateY(15px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* THEMES OVERRIDES */
body.theme-electric {
    --accent-cyan: #007bff;
    --accent-blue-mid: #0056b3;
    --accent-blue-deep: #004085;
}

body.theme-neon {
    --accent-cyan: #ff00ff;
    --accent-blue-mid: #cc00cc;
    --accent-blue-deep: #990099;
}

body.theme-lime {
    --accent-cyan: #39ff14;
    --accent-blue-mid: #32e612;
    --accent-blue-deep: #28b80e;
}

body.theme-cosmic {
    --accent-cyan: #d500f9;
    --accent-blue-mid: #aa00ff;
    --accent-blue-deep: #651fff;
}

body.theme-emerald {
    --accent-cyan: #1de9b6;
    --accent-blue-mid: #00bfa5;
    --accent-blue-deep: #00796b;
}

body.theme-sunset {
    --accent-cyan: #ff1744;
    --accent-blue-mid: #f50057;
    --accent-blue-deep: #c51162;
}

body.theme-gold {
    --accent-cyan: #ffc400;
    --accent-blue-mid: #ffab00;
    --accent-blue-deep: #ff8f00;
}

body.theme-midnight {
    --accent-cyan: #c6ff00;
    --accent-blue-mid: #aeea00;
    --accent-blue-deep: #827717;
}

body.theme-azure {
    --accent-cyan: #00b0ff;
    --accent-blue-mid: #0091ea;
    --accent-blue-deep: #00b8d4;
}

body.theme-flame {
    --accent-cyan: #ff9100;
    --accent-blue-mid: #ff6d00;
    --accent-blue-deep: #e65100;
}

/* --- MONITOR MODE (INTERACTIVE GHOSTS) --- */
body.is-monitor-mode .unit {
    /* Permitir interacción siempre */
    pointer-events: auto !important;

    /* Asegurar que siempre se rendericen (aunque estén hidden) */
    visibility: visible !important;
    display: flex !important;
}

/* Estado OCULTO en Monitor (Fantasmas Rojos Interactivos) */
body.is-monitor-mode .unit.is-hidden {
    /* Hacer visible lo invisible */
    opacity: 0.4 !important;

    /* Efecto Rojo Fantasma (Advertencia Visual) */
    filter: drop-shadow(0 0 10px red) grayscale(100%) sepia(100%) hue-rotate(-50deg) saturate(500%) !important;

    /* Cancelar animaciones de salida para que se quede en su sitio esperando ser editado */
    animation: none !important;
    transform: var(--base-transform) scale(var(--current-scale)) !important;

    /* Borde punteado para indicar "Oculto" */
    border: 1px dashed rgba(255, 0, 0, 0.5);
    border-radius: 20px;
}

/* Excepción: Si estamos editando (seleccionado), quitar filtro rojo visualmente para ver color real */
body.is-monitor-mode .unit.is-hidden.is-selected {
    filter: none !important;
    opacity: 0.8 !important;
    border: 2px solid #00e5ff;
}

/* OPTIMIZACIÓN DE RENDIMIENTO: Al arrastrar, quitar TODOS los filtros y efectos pesados */
body.is-monitor-mode .unit.is-dragging {
    filter: none !important;
    backdrop-filter: none !important;
    box-shadow: none !important;
    opacity: 0.7 !important;
    transition: none !important;
    will-change: transform;
    /* Aceleración por hardware */

    /* Borde simple para referencia rápida */
    border: 2px dashed #ffff00 !important;
}

/* --- GLOBAL TEXT ONLY MODE (SOLO TEXTO) --- */

/* Transiciones suaves SOLO para los globos (no el texto) */
.glass-panel,
.verse-glass-panel {
    transition:
        background 0.6s cubic-bezier(0.4, 0, 0.2, 1),
        border 0.6s cubic-bezier(0.4, 0, 0.2, 1),
        box-shadow 0.6s cubic-bezier(0.4, 0, 0.2, 1),
        backdrop-filter 0.6s cubic-bezier(0.4, 0, 0.2, 1),
        -webkit-backdrop-filter 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.border-glow,
.verse-neon-line {
    transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Estado cuando se activa Solo Texto */
body.global-text-only .glass-panel,
body.global-text-only .verse-glass-panel,
body.global-text-only .verse-citation-tag {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
}

body.global-text-only .border-glow,
body.global-text-only .verse-neon-line {
    opacity: 0;
}

/* Permitir que el texto se lea bien sin fondo (opcional: añadir sombra de texto suave) */
body.global-text-only .unit-text {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), -1px -1px 0 rgba(0, 0, 0, 0.5) !important;
}

body.global-text-only .verse-content,
body.global-text-only .verse-citation-tag {
    /* Combinamos una base de seguridad con el slider del usuario */
    text-shadow:
        2px 2px 4px rgba(0, 0, 0, calc(0.8 * var(--global-shadow))),
        0 calc(4px * var(--global-shadow)) calc(15px * var(--global-shadow)) rgba(0, 0, 0, calc(0.9 * var(--global-shadow))),
        0 0 calc(30px * var(--global-shadow)) rgba(0, 229, 255, calc(0.25 * var(--global-shadow))) !important;
}